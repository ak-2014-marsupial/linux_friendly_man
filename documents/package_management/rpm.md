# Посібник з команди `rpm`

`rpm` (RPM Package Manager) — це потужна система керування пакунками, яка є основою для дистрибутивів Linux, що походять від Red Hat (RHEL, CentOS, Fedora, Oracle Linux та інші). `rpm` — це низькорівневий інструмент, що дозволяє встановлювати, оновлювати, видаляти, запитувати та перевіряти програмні пакунки у форматі `.rpm`.

### **Ключова концепція: `rpm` проти `yum`/`dnf`**

Дуже важливо розуміти різницю між `rpm` та високорівневими менеджерами, як `yum` або `dnf`.

*   **`rpm`**: Працює з окремими файлами пакунків (`.rpm`), які вже є на вашому диску. `rpm` **не вміє автоматично вирішувати залежності**. Якщо пакунок `A` вимагає пакунок `B`, ви повинні вручну знайти та встановити пакунок `B` перед встановленням `A`.
*   **`yum`/`dnf`**: Працюють з репозиторіями (віддаленими сховищами пакунків). Вони автоматично знаходять потрібний пакунок, **вирішують усі його залежності**, завантажують усе необхідне, а потім використовують `rpm` "під капотом" для фактичного встановлення.

**Висновок**: для звичайного встановлення та оновлення програм завжди використовуйте `yum` або `dnf`. `rpm` використовується для специфічних завдань: запитів до бази даних пакунків, перевірки файлів або встановлення `.rpm` файлу, який ви завантажили вручну.

### **Режими роботи та базовий синтаксис**

```bash
rpm --[режим] [опції] [назва_пакунка_або_файл]
```

#### **Основні режими**

| Режим | Прапор | Пояснення |
| :--- | :--- | :--- |
| Запит | `-q` | **(Query)**. Отримати інформацію про пакунки. |
| Встановлення | `-i` | **(Install)**. Встановити новий пакунок з `.rpm` файлу. |
| Оновлення | `-U` | **(Upgrade)**. Оновити існуючий пакунок або встановити, якщо його немає. **Рекомендований спосіб.** |
| Оновлення (встановлених) | `-F` | **(Freshen)**. Оновити пакунок, тільки якщо він вже встановлений. |
| Видалення | `-e` | **(Erase)**. Видалити (деінсталювати) пакунок. |
| Перевірка цілісності | `-V` | **(Verify)**. Перевірити цілісність встановленого пакунка. |
| Перевірка підпису | `-K` | **(Check Signature)**. Перевірити GPG-підпис `.rpm` файлу. |
| Робота з базою даних | `--rebuilddb` | Перебудувати базу даних пакунків. |

---

### **Найпоширеніші опції та приклади**

#### **1. Запити до бази даних пакунків (`-q`)**

Режим запиту (`-q`) майже завжди використовується з додатковими ключами, які уточнюють, яку саме інформацію ви хочете отримати. Ось найпоширеніші з них:

| Ключ | Повна назва | Пояснення |
| :--- | :--- | :--- |
| `-a` | `--all` | Застосувати запит до **всіх** встановлених пакунків. |
| `-f` | `--file` | Знайти, якому пакунку належить **файл**. |
| `-l` | `--list` | Показати **список** файлів у пакунку. |
| `-i` | `--info` | Показати детальну **інформацію** про пакунок. |
| `-R` | `--requires` | Показати **залежності** (requires) пакунка. |
| `-p` | `--package` | Застосувати запит до `.rpm` **файлу пакунка**, а не до встановленої системи. |

Нижче наведено приклади комбінацій цих ключів.

*   **Перевірити, чи встановлено пакунок, та його версію:**
    ```bash
    rpm -q httpd
    ```

*   **Показати список ВСІХ встановлених пакунків (часто з `grep`):**
    ```bash
    rpm -qa | grep kernel
    ```

*   **Отримати детальну інформацію про встановлений пакунок:**
    ```bash
    rpm -qi wget
    ```

*   **Показати список файлів, що належать встановленому пакунку:**
    ```bash
    rpm -ql coreutils
    ```

*   **Дізнатися, якому пакунку належить конкретний файл:**
    ```bash
    rpm -qf /etc/yum.conf
    ```

*   **Показати список залежностей пакунка:**
    ```bash
    rpm -qR coreutils
    # або rpm -q --requires coreutils
    ```

*   **Показати історію змін пакунка (changelog):**
    ```bash
    rpm -q --changelog coreutils
    ```

*   **Подивитися інформацію з `.rpm` файлу, який ще НЕ встановлено:**
    ```bash
    # -p означає "package file"
    rpm -qip my-package-1.0.rpm # Інформація про пакунок
    rpm -qpl my-package-1.0.rpm # Список файлів у пакунку
    rpm -qpR my-package-1.0.rpm # Залежності пакунка
    ```

#### **2. Встановлення, оновлення та видалення**

Для цих операцій потрібні права `root` (`sudo`). Режими встановлення (`-i`), оновлення (`-U`, `-F`) та видалення (`-e`) контролюються однаковим набором додаткових ключів:

| Ключ | Повна назва | Пояснення |
| :--- | :--- | :--- |
| `-v` | `--verbose` | Виводити детальну інформацію про процес. |
| `-h` | `--hash` | Показувати прогрес-бар у вигляді хеш-символів (`#`). Використовується тільки при встановленні/оновленні. |
| `--test` | | Провести тестову операцію без реальних змін у системі. |
| `--nodeps`| | Ігнорувати перевірку залежностей (небезпечно). |
| `--force` | | Примусово виконати операцію, ігноруючи конфлікти файлів або версій (дуже небезпечно). |

Нижче наведено приклади комбінацій цих ключів.

*   **Встановити пакунок (з прогрес-баром та деталями):**
    *   Опції `-v` (verbose) та `-h` (hash) використовуються майже завжди.
    ```bash
    sudo rpm -ivh package-name.rpm
    ```

*   **Оновити пакунок (або встановити, якщо його не було):**
    ```bash
    sudo rpm -Uvh new-package-version.rpm
    ```

*   **Оновити тільки вже встановлений пакунок:**
    ```bash
    sudo rpm -Fvh new-package-version.rpm
    ```

*   **Видалити встановлений пакунок:**
    ```bash
    sudo rpm -e httpd
    ```

*   **Тестова установка ("сухий запуск"):**
    *   Команда перевірить залежності та конфлікти, але не внесе змін до системи.
    ```bash
    sudo rpm -ivh --test package-name.rpm
    ```

*   **Операції з ігноруванням правил (НЕБЕЗПЕЧНО):**
    *   **Використовуйте, тільки якщо ви на 100% впевнені, що робите.** Це може зламати систему.
    ```bash
    # Ігнорувати залежності при встановленні
    sudo rpm -ivh --nodeps broken-package.rpm

    # Ігнорувати залежності при видаленні
    sudo rpm -e --nodeps vital-package

    # Примусово перезаписати файли з інших пакунків
    sudo rpm -ivh --force package-name.rpm
    ```

#### **3. Перевірка цілісності пакунка (`-V`)**

Ця команда порівнює поточний стан файлів на диску з інформацією, збереженою в базі даних `rpm` (контрольні суми, права доступу, розмір тощо).

*   **Перевірити пакунок `coreutils`:**
    ```bash
    rpm -V coreutils
    ```
*   Якщо команда нічого не виводить — усі файли пакунка в порядку.
*   Якщо є зміни, вивід покаже, що саме змінилося. Наприклад:
    ```
    S.5....T.  c /etc/httpd/conf/httpd.conf
    ```
    Це означає, що у конфігураційного файлу `/etc/httpd/conf/httpd.conf` змінився розмір (`S`), контрольна сума MD5 (`5`) та час модифікації (`T`).

#### **4. Перевірка підпису файлу пакунка (`-K`)**

Цей режим перевіряє GPG-підпис `.rpm` файлу, щоб переконатися, що він не був змінений і походить з надійного джерела.

*   **Перевірити підпис:**
    ```bash
    rpm -K package-name-1.0.rpm
    # або rpm --checksig package-name-1.0.rpm
    ```
*   Якщо все добре, вивід буде містити `digests signatures OK`.

#### **5. Обслуговування бази даних RPM**

Іноді база даних `rpm` може пошкодитись.

*   **Перебудувати індекси бази даних:**
    *   Цю операцію слід виконувати, якщо `rpm` або `yum`/`dnf` повідомляють про помилки бази даних.
    ```bash
    sudo rpm --rebuilddb
    ```
