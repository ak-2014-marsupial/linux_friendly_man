Утиліта `lsof` (list open files) — це потужний інструмент командного рядка для виведення інформації про файли, які відкриті різними процесами в системі. "Файлами" в Unix-подібних системах вважається майже все: звичайні файли, директорії, мережеві сокети, канали (pipes) тощо.

#### **Базовий синтаксис**

```bash
lsof [ключі] [умови]
```

*   **`[ключі]`**: Параметри, що змінюють поведінку та формат виводу.
*   **`[умови]`**: Фільтри для вибору конкретних процесів, користувачів або файлів.

---

### **Основні колонки у виводі `lsof`**

| Колонка | Пояснення |
| :--- | :--- |
| **`COMMAND`** | Назва команди процесу, що відкрив файл. |
| **`PID`** | Ідентифікатор процесу (Process ID). |
| **`USER`** | Користувач, від імені якого запущено процес. |
| **`FD`** | Файловий дескриптор. Це номер, який процес використовує для доступу до файлу. |
| **`TYPE`** | Тип файлу (наприклад, `REG` для звичайного файлу, `DIR` для директорії, `IPv4` для сокета). |
| **`DEVICE`** | Ідентифікатор пристрою, на якому знаходиться файл. |
| **`SIZE/OFF`** | Розмір файлу або зміщення (offset) всередині нього. |
| **`NODE`** | Номер inode файлу. |
| **`NAME`** | Повний шлях до файлу або опис мережевого з'єднання. |

### **Значення файлових дескрипторів (FD)**

*   **`cwd`**: Поточна робоча директорія процесу (current working directory).
*   **`rtd`**: Коренева директорія процесу (root directory).
*   **`txt`**: Текстовий файл програми (виконуваний код).
*   **`mem`**: Файл, завантажений у пам'ять (memory-mapped file).
*   **`0, 1, 2`**: Стандартні потоки (0 - stdin, 1 - stdout, 2 - stderr).
*   **`NUMBERu`**: (наприклад, `3u`) — звичайний файловий дескриптор з номером 3, відкритий для читання та запису (`u`).
*   **`NUMBERr`**: (наприклад, `4r`) — дескриптор, відкритий тільки для читання (`r`).
*   **`NUMBERw`**: (наприклад, `5w`) — дескриптор, відкритий тільки для запису (`w`).

---

### **Основні ключі та умови**

*   **`-i [протокол][@хост][:порт]`**
    Показати мережеві з'єднання.
    *   `-i TCP` — показати тільки TCP-з'єднання.
    *   `-i :80` — показати, який процес слухає порт 80.
    *   `-i @192.168.1.1` — показати з'єднання з вказаною IP-адресою.

*   **`-p PID`**
    Показати файли, відкриті процесом із вказаним `PID`.
    *   *Приклад:* `lsof -p 1234`

*   **`-u ім'я_користувача`**
    Показати файли, відкриті процесами вказаного користувача.
    *   *Приклад:* `lsof -u andrew`

*   **`-c назва_команди`**
    Показати файли, відкриті процесами, назва яких починається з вказаного рядка.
    *   *Приклад:* `lsof -c ssh`

*   **`+D /шлях/до/директорії`**
    Рекурсивно показати всі файли, відкриті всередині вказаної директорії.
    *   *Приклад:* `lsof +D /var/log`

*   **`/шлях/до/файлу`**
    Вказати шлях до файлу як аргумент, щоб дізнатися, який процес його використовує.
    *   *Приклад:* `lsof /var/log/syslog`

---

### **Приклади використання**

1.  **Показати всі відкриті файли в системі (може бути дуже багато виводу):**
    ```bash
    sudo lsof
    ```

2.  **Дізнатися, який процес слухає порт 80 (HTTP):**
    ```bash
    sudo lsof -i :80
    ```

3.  **Показати всі мережеві з'єднання для користувача `www-data`:**
    ```bash
    sudo lsof -u www-data -i
    ```

4.  **Показати всі відкриті файли для процесу з PID 1 (systemd):**
    ```bash
    sudo lsof -p 1
    ```

5.  **Знайти, який процес використовує файл `/var/log/auth.log`:**
    ```bash
    sudo lsof /var/log/auth.log
    ```

6.  **Показати всі відкриті файли процесами, назва яких починається на `node`:**
    ```bash
    sudo lsof -c node
    ```

7.  **Показати всі TCP-з'єднання, встановлені з хостом `1.1.1.1`:**
    ```bash
    sudo lsof -i TCP@1.1.1.1
    ```

8.  **Показати всі файли, відкриті в директорії `/home/user/documents` та її піддиректоріях:**
    ```bash
    sudo lsof +D /home/user/documents
    ```

9.  **Показати всі відкриті файли, крім тих, що належать користувачу `root`:**
    ```bash
    sudo lsof -u ^root
    ```
    *(Символ `^` означає заперечення).*

10. **Скомбінувати умови: знайти, хто з користувачів, крім `root`, має відкриті IPv4 з'єднання:**
    ```bash
    sudo lsof -u ^root -i 4
    ```
