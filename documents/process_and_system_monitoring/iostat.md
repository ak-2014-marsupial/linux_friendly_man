# iostat

Утиліта `iostat` (Input/Output Statistics) — це інструмент для моніторингу навантаження на системні пристрої вводу/виводу (диски) та для отримання звітів про використання центрального процесора (CPU).

[=> Детальний розбір полів iostat та їх значень](./iostat_fields.md)

#### **Базовий синтаксис**

```bash
iostat [опції] [інтервал] [кількість]
```

*   **`[опції]`**: Ключі, що змінюють поведінку або формат виводу.
*   **`[інтервал]`**: Інтервал часу в секундах між оновленнями даних.
*   **`[кількість]`**: Кількість оновлень, після яких команда завершить роботу.

---

### **Опис полів виводу**

За замовчуванням `iostat` показує два типи звітів: використання CPU та статистика пристроїв.

#### **Звіт про використання CPU**

| Поле | Опис |
| :--- | :--- |
| **`%user`** | Відсоток часу CPU, витраченого на виконання процесів на рівні користувача. |
| **`%nice`** | Відсоток часу CPU, витраченого на процеси користувача з підвищеним пріоритетом (nice). |
| **`%system`**| Відсоток часу CPU, витраченого на виконання процесів на рівні ядра. |
| **`%iowait`**| Відсоток часу, протягом якого CPU простоював, очікуючи на завершення операції вводу/виводу. |
| **`%steal`** | Відсоток часу, "вкраденого" у віртуальної машини гіпервізором (актуально для віртуалізації). |
| **`%idle`** | Відсоток часу, протягом якого CPU був у простої і не очікував на I/O. |

#### **Звіт про використання пристроїв (базовий)**

| Поле | Опис |
| :--- | :--- |
| **`Device`** | Ім'я пристрою (диска або розділу). |
| **`tps`** | Кількість транзакцій (запитів на читання/запис) за секунду. |
| **`kB_read/s`** | Кількість кілобайт, прочитаних з пристрою за секунду. |
| **`kB_wrtn/s`** | Кількість кілобайт, записаних на пристрій за секунду. |
| **`kB_read`** | Загальна кількість кілобайт, прочитаних з пристрою. |
| **`kB_wrtn`** | Загальна кількість кілобайт, записаних на пристрій. |

#### **Розширений звіт (`-x`)**

Ключ `-x` надає набагато детальнішу статистику, яка є ключовою для аналізу продуктивності.

| Поле | Опис |
| :--- | :--- |
| **`r/s`, `w/s`** | Кількість запитів на читання/запис, виконаних за секунду. |
| **`rMB/s`, `wMB/s`** | Швидкість читання/запису в мегабайтах за секунду. |
| **`avgrq-sz`** | Середній розмір запиту (в секторах). |
| **`avgqu-sz`** | Середня довжина черги запитів до пристрою. |
| **`await`** | Середній час очікування (в мілісекундах) для запитів, включаючи час у черзі та час обслуговування. **Ключовий показник!** |
| **`r_await`, `w_await`** | Середній час очікування для запитів на читання та запис відповідно. |
| **`%util`** | Відсоток часу, протягом якого пристрій був зайнятий виконанням запитів. Якщо цей показник наближається до 100%, пристрій є "вузьким місцем". |

---

### **Основні ключі (опції)**

| Ключ | Пояснення |
| :--- | :--- |
| **`-c`** | Показати лише звіт про використання CPU. |
| **`-d`** | Показати лише звіт про використання пристроїв. |
| **`-k`** | Показувати статистику в кілобайтах за секунду (за замовчуванням). |
| **`-m`** | Показувати статистику в мегабайтах за секунду. |
| **`-x`** | Вивести розширену статистику. **Дуже рекомендовано для аналізу.** |
| **`-p [пристрій]`** | Показати статистику для конкретного блочного пристрою (наприклад, `sda`) та всіх його розділів. |
| **`-t`** | Додавати часову мітку до кожного звіту. |
| **`-N`** | Показувати імена пристроїв, зареєстровані в LVM (Logical Volume Manager). |
| **`-n`** | Показати статистику використання мережевих файлових систем (NFS). |
| **`-z`** | Приховати пристрої, які були неактивні протягом інтервалу. |

---

### **Приклади використання**

1.  **Отримати базовий звіт (CPU та диски):**
    *Перший звіт показує середні значення з моменту завантаження системи.*
    ```bash
    iostat
    ```

2.  **Моніторити статистику кожні 2 секунди:**
    ```bash
    iostat 2
    ```

3.  **Отримати 5 звітів з інтервалом в 2 секунди:**
    ```bash
    iostat 2 5
    ```

4.  **Показати лише статистику по дисках в мегабайтах:**
    ```bash
    iostat -d -m
    ```

5.  **Показати розширену статистику для всіх пристроїв з оновленням кожні 3 секунди:**
    *Це один з найкорисніших режимів для діагностики проблем з дисковою підсистемою.*
    ```bash
    iostat -x 3
    ```

6.  **Показати розширену статистику лише для пристрою `sda` та його розділів:**
    ```bash
    iostat -x -p sda 2
    ```

7.  **Показати лише статистику CPU:**
    ```bash
    iostat -c 2
    ```

8.  **Вивести розширену статистику з часовими мітками:**
    ```bash
    iostat -x -t 5
    ```

9.  **Показати розширену статистику, приховуючи неактивні пристрої:**
    *Ключ `-z` (`--zero`) дозволяє прибрати зі звіту пристрої, на яких не було активності.*
    ```bash
    iostat -zx 1
    ```

10. **Моніторити статистику NFS та дисків, приховуючи неактивні пристрої:**
    *Комбінація `-xnz` показує розширену статистику (`x`), статистику NFS (`n`) і приховує неактивні пристрої (`z`).*
    ```bash
    iostat -xnz 1
    ```
