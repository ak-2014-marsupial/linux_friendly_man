# Посібник з утиліти `top`

`top` (table of processes) — це стандартна утиліта командного рядка, яка надає динамічний огляд системи в реальному часі. Вона відображає системну інформацію (про процесор, пам'ять, завдання) та список процесів, які на даний момент виконуються ядром.

[=> Детальний розбір полів top та їх значень](./top_fields.md)

### **Ключова концепція: Інтерактивний монітор**

`top` — це інтерактивна програма. Після запуску вона оновлює дані на екрані кожні кілька секунд (за замовчуванням — 3). Її вивід можна умовно розділити на дві частини:
1.  **Верхня панель (Dashboard)**: Зведена інформація про стан системи.
2.  **Нижня панель**: Список процесів, відсортований за певним критерієм.

Щоб вийти з `top`, натисніть клавішу `q`.

### **Розшифровка верхньої панелі**

#### **Рядок 1: `top`**
`top - 14:30:00 up 10 days,  2:15,  1 user,  load average: 0.05, 0.15, 0.12`
*   `14:30:00` — поточний час.
*   `up 10 days, 2:15` — час роботи системи з останнього перезавантаження.
*   `1 user` — кількість користувачів у системі.
*   `load average: 0.05, 0.15, 0.12` — середнє навантаження на систему за останню 1, 5 та 15 хвилин. Це показник черги процесів, що чекають на виконання. Для системи з одним ядром значення > 1.0 може свідчити про перевантаження.

#### **Рядок 2: `Tasks`**
`Tasks: 250 total,   1 running, 249 sleeping,   0 stopped,   0 zombie`
*   Загальна кількість процесів та їхній стан: виконуються, "сплять", зупинені, "зомбі".

#### **Рядок 3: `%Cpu(s)`**
`%Cpu(s):  2.5 us,  1.2 sy,  0.0 ni, 96.0 id,  0.1 wa,  0.0 hi,  0.2 si,  0.0 st`
*   **`us`** (user): відсоток часу CPU, витрачений на процеси користувача.
*   **`sy`** (system): відсоток часу CPU, витрачений на процеси ядра.
*   **`id`** (idle): **відсоток часу, коли CPU простоює.** Це ключовий показник: якщо він близький до 0, процесор повністю завантажений.
*   **`wa`** (I/O wait): відсоток часу, який CPU провів в очікуванні завершення операцій вводу/виводу (наприклад, читання з диска).

#### **Рядки 4 та 5: `MiB Mem` та `MiB Swap`**
Показують використання фізичної (RAM) та swap-пам'яті: загальний обсяг, вільний, використаний.

### **Розшифровка списку процесів**

| Стовпець | Пояснення |
| :--- | :--- |
| **`PID`** | ID процесу. |
| **`USER`** | Користувач, від імені якого запущено процес. |
| **`PR`** | Пріоритет процесу. |
| **`NI`** | "Nice" value — впливає на пріоритет. |
| **`VIRT`** | Віртуальна пам'ять, використана процесом. |
| **`RES`** | **(Resident)**. Фізична пам'ять (RAM), яку реально використовує процес. |
| **`SHR`** | Розділювана пам'ять. |
| **`S`** | Статус процесу (`R` - running, `S` - sleeping, `Z` - zombie). |
| **`%CPU`** | **Відсоток використання CPU** процесом з останнього оновлення. |
| **`%MEM`** | **Відсоток використання RAM** процесом. |
| **`TIME+`** | Загальний час роботи CPU, витрачений на цей процес. |
| **`COMMAND`** | Назва команди, що запустила процес. |

---

### **Інтерактивні команди (вводяться всередині `top`)**

| Клавіша | Дія |
| :--- | :--- |
| **`q`** | **(Quit)**. Вийти з `top`. |
| **`h`** | **(Help)**. Показати довідку. |
| **`P`** (велика) | Сортувати процеси за використанням **CPU** (за замовчуванням). |
| **`M`** (велика) | Сортувати процеси за використанням **пам'яті** (`%MEM`). |
| **`T`** (велика) | Сортувати процеси за **часом роботи** (`TIME+`). |
| **`R`** (велика) | Змінити порядок сортування (зростаючий/спадний). |
| **`c`** | Переключити відображення стовпця `COMMAND` між короткою назвою та повним шляхом з аргументами. |
| **`u`** | Фільтрувати процеси за іменем користувача (потрібно буде ввести ім'я). |
| **`k`** | **(Kill)**. "Вбити" процес. `top` запитає PID процесу та сигнал (за замовчуванням 15 - SIGTERM). |
| **`r`** | **(Renice)**. Змінити пріоритет процесу. |
| **`1`** | Переключити відображення завантаження CPU між загальним та детальним по кожному ядру. |
| **`z`** | Увімкнути/вимкнути кольоровий режим. |
| **`d`** або **`s`** | Змінити затримку оновлення екрана. |

### **Практичні сценарії**

*   **"Що навантажує процесор?"**
    1.  Запустіть `top`.
    2.  Натисніть `P` (Shift + p), щоб відсортувати за CPU. Процеси вгорі списку — основні споживачі.

*   **"Що використовує всю пам'ять?"**
    1.  Запустіть `top`.
    2.  Натисніть `M` (Shift + m), щоб відсортувати за RAM.

*   **"Як відсортувати процеси за використанням фізичної пам'яті (RES)?"**
    Якщо ви хочете переконатися, що RES (Resident Set Size) відображається, або хочете встановити його полем для сортування:
    1.  Натисніть `f` у головному вікні top.
    2.  Стрілками Вгору/Вниз знайдіть поле RES.
    3.  Якщо перед RES немає зірочки (*), натисніть `d` або `Пробіл`, щоб увімкнути його відображення.
    4.  Натисніть `s` на полі RES, щоб встановити його полем для сортування.
    5.  Натисніть `q` або `Esc` для виходу та застосування змін.

*   **"Як вбити процес, що завис?"**
    1.  Знайдіть процес у списку, подивіться його `PID`.
    2.  Натисніть `k`.
    3.  Введіть `PID` процесу і натисніть `Enter`.
    4.  Натисніть `Enter` ще раз, щоб надіслати стандартний сигнал 15. Якщо процес не реагує, повторіть, але введіть сигнал `9` (SIGKILL).

### **Фільтрація процесів**

*   **"Як відфільтрувати процеси за користувачем?"**
    1.  У `top` натисніть `u`.
    2.  Введіть ім'я користувача (наприклад, `root` або `andrew`) і натисніть `Enter`. Будуть показані лише процеси цього користувача.
    3.  Щоб скасувати фільтр, знову натисніть `u` і просто натисніть `Enter` без введення імені користувача.

*   **"Як показати лише активні процеси (ті, що використовують CPU)?"**
    1.  У `top` натисніть `i` (або `I`). Це переключить відображення між усіма процесами та лише тими, що не простоюють (idle).

*   **"Як відфільтрувати процеси за використанням CPU (більше X%)?"**
    `top` не має прямої інтерактивної команди для фільтрації за порогом CPU. Однак, ви можете відсортувати за CPU (`P`) і візуально ідентифікувати процеси. Для більш точної фільтрації можна використовувати `top` у пакетному режимі з `grep` або `awk`:
    ```bash
    top -b -n 1 | head -n 7 && top -b -n 1 | tail -n +8 | awk '$9 > 5.0 {print}'
    ```
    Ця команда покаже верхню панель `top` та процеси, які використовують більше 5% CPU. Замініть `5.0` на бажаний поріг.

*   **"Як відфільтрувати процеси за використанням пам'яті (більше X MiB)?"**
    Аналогічно CPU, прямої інтерактивної фільтрації немає. Можна використовувати пакетний режим:
    ```bash
    top -b -n 1 | head -n 7 && top -b -n 1 | tail -n +8 | awk '$6 > 1024 {print}'
    ```
    Ця команда покаже верхню панель `top` та процеси, які використовують більше 1024 MiB (1 GiB) резидентної пам'яті (`RES`, стовпець $6). Замініть `1024` на бажаний поріг.

### **Розширена фільтрація (режим 'O')**

`top` надає потужний механізм для створення власних фільтрів за допомогою інтерактивної команди `O` (велика 'o'). Це дозволяє будувати складні вирази для відбору процесів за різними критеріями.

*   **"Як відфільтрувати процеси за назвою (COMMAND)?"**
    1.  У `top` натисніть `O` (велика 'o').
    2.  З'явиться рядок для введення фільтра, наприклад `add filter #1 (case sensitive) as: ...`
    3.  Введіть вираз, що фільтрує. Наприклад, щоб показати всі процеси, в назві яких є `bash`:
        ```
        COMMAND=bash
        ```
    4.  Натисніть `Enter`. `top` покаже лише ті процеси, що відповідають умові.

*   **"Як відфільтрувати процеси, що використовують більше 5% CPU?"**
    1.  Натисніть `O`.
    2.  Введіть умову, використовуючи назву поля (вона чутлива до регістру) та числове значення:
        ```
        %CPU>5
        ```
    3.  Натисніть `Enter`.

*   **"Як скомбінувати кілька фільтрів?"**
    Ви можете поєднувати умови за допомогою символу `&`. Наприклад, щоб знайти всі процеси користувача `andrew`, які використовують більше 1% CPU:
    1.  Натисніть `O`.
    2.  Введіть комбінований вираз:
        ```
        USER=andrew&%CPU>1
        ```
    3.  Натисніть `Enter`.

*   **"Як скинути всі фільтри?"**
    Натисніть `=` (знак рівності). Це скине всі користувацькі фільтри, які ви застосували.

### **`top` проти `htop`**

`htop` — це сучасна, покращена альтернатива `top`. Якщо у вас є можливість, рекомендується встановити її (`sudo dnf install htop` або `sudo apt install htop`).
*   **Переваги `htop`**: кольоровий інтерфейс за замовчуванням, зручна прокрутка, інтуїтивне керування за допомогою функціональних клавіш (F1-F10), деревоподібний вигляд процесів.
*   **Перевага `top`**: він є абсолютно на кожній Unix-системі, навіть на наймінімальнішій. Знати його основи необхідно.
