# Посібник з використання утиліти `su`

Утиліта `su` (substitute user або switch user) — це стандартна команда в Unix-подібних системах, призначена для переключення на інший обліковий запис користувача без необхідності виходити з поточної сесії.

Найчастіше її використовують для отримання прав суперкористувача (`root`), але вона може бути використана для переключення на будь-якого користувача в системі.

#### **Базовий синтаксис**

```bash
su [опції] [ім'я_користувача]
```

*   **`[опції]`**: Ключі, що змінюють поведінку `su`.
*   **`[ім'я_користувача]`**: Логін користувача, на якого потрібно переключитися. Якщо ім'я не вказано, `su` намагається переключитися на `root`.

**Ключова відмінність від `sudo`**: `su` за замовчуванням запитує пароль **цільового користувача** (того, на якого ви переключаєтесь). Наприклад, щоб стати `root`, потрібно ввести пароль `root`.

---

### **Основні опції (ключі)**

| Опція | Пояснення |
| :--- | :--- |
| **`-`**, **`-l`**, **`--login`** | **(Найважливіша опція)**. Створює **логінову оболонку** (login shell). Це повністю імітує вхід у систему під новим користувачем: завантажується його середовище, виконуються стартові скрипти (`.profile`, `.bashrc`), а поточною директорією стає домашня директорія нового користувача. **Це рекомендований спосіб використання `su`.** |
| **`-c "команда"`** | (`--command`) Виконати одну вказану команду від імені цільового користувача, після чого одразу повернутися до попереднього користувача. |
| **`-s [оболонка]`** | (`--shell`) Вказати, яку командну оболонку (shell) запустити, замість тієї, що прописана для користувача за замовчуванням. |

---

### **Різниця між `su` та `su -`**

Розуміння цієї різниці є критично важливим для правильного використання команди.

#### **`su [user]` (нелогінова оболонка)**

Якщо викликати `su` без опції `-`, створюється **нелогінова оболонка** (non-login shell). Це означає:

1.  **Ви стаєте новим користувачем**, але **зберігаєте значну частину старого середовища**. Змінні оточення, як-от `$PATH`, `$HOME`, можуть залишитися від попереднього користувача.
2.  **Ви залишаєтесь у тій самій директорії**, де були до виклику `su`.

Така поведінка може призвести до помилок. Наприклад, ви можете спробувати запустити команду, яка доступна для `root`, але шлях до неї не прописаний у `$PATH` вашого звичайного користувача, і ви отримаєте помилку "command not found".

**Приклад:**
```bash
andrew@host:~$ pwd
/home/andrew
andrew@host:~$ su
Password: # <-- тут потрібен пароль root
root@host:/home/andrew# echo $HOME
/home/andrew # <-- $HOME залишився від andrew, хоча має бути /root
```

#### **`su - [user]` (логінова оболонка)**

Це правильний та рекомендований спосіб переключення користувача.

1.  **Створюється повністю нове, чисте середовище**, яке повністю відповідає тому, що отримав би користувач при вході в систему.
2.  **Завантажуються всі файли конфігурації** цільового користувача (наприклад, `/root/.profile`).
3.  **Поточна директорія змінюється** на домашню директорію цільового користувача (наприклад, `/root`).

**Приклад:**
```bash
andrew@host:~$ pwd
/home/andrew
andrew@host:~$ su -
Password: # <-- тут потрібен пароль root
root@host:~# pwd
/root
root@host:~# echo $HOME
/root # <-- $HOME тепер правильний
```

---

### **Порівняння `su` та `sudo`**

| Критерій | `su` | `sudo` |
| :--- | :--- | :--- |
| **Пароль** | Вимагає пароль **цільового користувача** (напр., `root`). | Вимагає пароль **поточного користувача**. |
| **Безпека** | Менш безпечно. Потрібно ділитися паролем `root` з усіма, хто має його адмініструвати. | Більш безпечно. Пароль `root` нікому не повідомляється. Дозволи видаються конкретним користувачам. |
| **Рівень доступу** | "Все або нічого". Дає повний доступ до облікового запису. | Дозволяє налаштувати гранульований доступ (дозволити лише певні команди). |
| **Аудит (Logging)** | Записує в лог лише факт переключення користувача. Подальші дії не логуються. | Детально логує кожну команду, виконану через `sudo`. Це стандарт для корпоративного середовища. |

**Висновок**: `sudo` є сучасним і більш безпечним інструментом для адміністрування. `su` корисна в ситуаціях, коли вам дійсно потрібен повноцінний інтерактивний сеанс іншого користувача, і ви знаєте його пароль.

### **Приклади використання**

1.  **Переключитися на `root` з повним середовищем (правильний спосіб):**
    ```bash
    su -
    ```

2.  **Переключитися на системного користувача `postgres` для роботи з базою даних:**
    ```bash
    su - postgres
    ```

3.  **Виконати одну команду від імені `root` і вийти:**
    ```bash
    su - -c "systemctl restart networking"
    ```

4.  **Переключитися на користувача `testuser`, але залишитися в поточній директорії:**
    ```bash
    su testuser
    ```
