Команда `systemctl` (system control) — це основний інструмент для керування `systemd`, системним та сервісним менеджером у більшості сучасних дистрибутивів Linux. Вона використовується для запуску, зупинки, перезапуску сервісів, перевірки їхнього статусу, керування автозавантаженням та аналізу стану системи.

#### **Базовий синтаксис**

```bash
systemctl [КЛЮЧІ] [КОМАНДА] [НАЗВА_ЮНІТА]
```
*   `[КЛЮЧІ]` — додаткові параметри, що змінюють поведінку команди (наприклад, `--failed`, `--type=service`).
*   `[КОМАНДА]` — дія, яку потрібно виконати (наприклад, `start`, `stop`, `status`).
*   `[НАЗВА_ЮНІТА]` — ім'я юніта, яким потрібно керувати (наприклад, `nginx.service`). Розширення `.service` для сервісів можна не вказувати.

---

### **Основні команди для керування юнітами**

| Команда | Опис |
| :--- | :--- |
| `start` | Запустити юніт (сервіс, сокет тощо). |
| `stop` | Зупинити юніт. |
| `restart` | Перезапустити юніт (зупинити і знову запустити). |
| `reload` | Перезавантажити конфігурацію юніта без його повної зупинки. Не всі юніти підтримують цю команду. |
| `status` | Показати детальний статус юніта, включаючи останні логи. |
| `enable` | Додати юніт в автозавантаження при старті системи. |
| `disable` | Видалити юніт з автозавантаження. |
| `is-active` | Перевірити, чи запущений юніт зараз. Повертає `active` або `inactive`. |
| `is-enabled` | Перевірити, чи доданий юніт в автозавантаження. Повертає `enabled` або `disabled`. |
| `daemon-reload` | Перечитати конфігураційні файли `systemd`. Потрібно після створення або зміни юніт-файлів. |
| `list-units` | Показати список активних юнітів, завантажених `systemd`. |
| `list-unit-files` | Показати список усіх доступних юніт-файлів та їхній статус (`enabled`, `disabled`, `static`). |
| `mask` | Повністю відключити юніт, запобігаючи його запуску вручну або іншими юнітами. Створює символічне посилання на `/dev/null`. |
| `unmask` | Скасувати дію `mask`, дозволяючи юніту знову запускатися. |


---

### **Основні ключі (прапори)**

Ключі дозволяють фільтрувати вивід або змінювати поведінку `systemctl`.

| Ключ | Повна назва | Опис | Приклад |
| :--- | :--- | :--- | :--- |
| `-t` | `--type` | Фільтрує юніти за їхнім типом. Найпоширеніші типи: `service`, `socket`, `target`, `mount`, `timer`. | `systemctl -t service` |
| | `--state` | Фільтрує юніти за їхнім станом. Наприклад: `running`, `failed`, `exited`, `plugged`. | `systemctl --state=failed` |
| `-a` | `--all` | Показує всі юніти, незалежно від їхнього стану (включаючи неактивні). Без цього ключа `list-units` показує лише активні. | `systemctl list-units -a` |
| | `--failed` | Зручний псевдонім для `list-units --state=failed --type=service`. Показує всі сервіси, що не змогли запуститися. | `systemctl --failed` |
| `-l` | `--full` | Показує повні імена юнітів та їх опис, запобігаючи скороченню довгих рядків. | `systemctl status -l nginx` |
| `-p` | `--property` | Дозволяє отримати значення лише одного конкретного параметра юніта. | `systemctl show -p MainPID nginx` |
| | `--now` | Використовується з `enable` або `disable`, щоб не тільки додати/видалити з автозавантаження, а й одразу запустити/зупинити юніт. | `sudo systemctl enable --now sshd` |
| `-H` | `--host` | Дозволяє виконати команду `systemctl` на віддаленій машині через SSH. | `systemctl -H user@host status nginx`|
| | `--user` | Керує сервісами, що запущені від імені поточного користувача, а не системи. | `systemctl --user status my-app` |

---

### **Розшифровка виводу `systemctl status`**

```
● nginx.service - A high performance web server and a reverse proxy server
     Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)
     Active: active (running) since Fri 2023-10-27 10:00:00 EET; 1 day 2h ago
       Docs: man:nginx(8)
   Main PID: 1234 (nginx)
      Tasks: 2 (limit: 4617)
     Memory: 12.3M
        CPU: 45s
     CGroup: /system.slice/nginx.service
             ├─1234 /usr/sbin/nginx -g daemon on; master_process on;
             └─1235 /usr/sbin/nginx -g daemon on; master_process on;
```

*   **`Loaded`**: Показує шлях до файлу сервісу (`.service`), чи він в автозавантаженні (`enabled`/`disabled`).
*   **`Active`**: Стан сервісу:
    *   `active (running)` — сервіс запущений і працює.
    *   `inactive (dead)` — сервіс зупинений.
    *   `failed` — сервіс не зміг запуститися.
    *   `reloading` — сервіс перезавантажує конфігурацію.
*   **`Docs`**: Посилання на документацію.
*   **`Main PID`**: ID головного процесу сервісу.
*   **`Tasks`**: Кількість задач (процесів/потоків), створених сервісом.
*   **`Memory`**: Обсяг пам'яті, що використовується.
*   **`CGroup`**: Інформація про контрольну групу, яка ізолює ресурси процесу.
*   **Логи**: Нижче виводяться останні записи з журналу, що стосуються цього сервісу.

---

### **Приклади використання**

1.  **Перевірити статус веб-сервера Nginx з повним виводом:**
    ```bash
    systemctl status -l nginx
    ```

2.  **Запустити сервіс SSH і одразу додати його в автозавантаження:**
    ```bash
    # Для керування системними сервісами потрібні права суперкористувача (sudo).
    sudo systemctl enable --now sshd
    ```
    *Ця команда еквівалентна двом окремим: `sudo systemctl start sshd` та `sudo systemctl enable sshd`.*

3.  **Показати всі запущені сервіси:**
    ```bash
    systemctl list-units --type=service --state=running
    ```

4.  **Показати всі сервіси, які не вдалося запустити:**
    ```bash
    systemctl --failed
    ```
    *Це короткий і зручний спосіб знайти проблеми в системі.*

5. **Перезапустити сервіс після зміни його юніт-файлу:**
   ```bash
   # 1. Внесіть зміни у файл /etc/systemd/system/my-app.service
   # 2. Накажіть systemd перечитати конфігурацію
   sudo systemctl daemon-reload
   # 3. Перезапустіть сервіс, щоб застосувати зміни
   sudo systemctl restart my-app.service
   ```

6. **Отримати лише ідентифікатор головного процесу (PID) сервісу:**
   ```bash
   systemctl show --property MainPID --value nginx
   ```
   *Ключ `--value` прибирає назву властивості, залишаючи тільки її значення.*

---

### **Керування системою**

`systemctl` також використовується для керування станом самої системи. Ці команди є зручними псевдонімами для керування відповідними `.target` юнітами.

| Команда | Опис |
| :--- | :--- |
| `reboot` | Перезавантажити систему. |
| `poweroff` | Вимкнути живлення. |
| `suspend` | Перевести систему в режим сну (збереження стану в RAM). |
| `hibernate` | Перевести систему в режим глибокого сну (збереження стану на диск). |
| `rescue` | Увійти в режим відновлення (однокористувацький режим). |
| `get-default` | Показати ціль за замовчуванням (наприклад, `graphical.target`). |
| `set-default` | Встановити ціль за замовчуванням (наприклад, `multi-user.target` для консольного режиму). |

**Приклад:**
Перемкнутися в консольний режим без перезавантаження.
```bash
sudo systemctl isolate multi-user.target
```
*Команда `isolate` перемикає систему на вказаний `.target` юніт, зупиняючи всі інші, що не є його залежностями. Це корисно для тимчасової зміни режиму роботи системи.*

7. **Повністю відключити (замаскувати) сервіс:**
   ```bash
   sudo systemctl mask apache2.service
   ```
   *Команда `mask` створює символічне посилання на `/dev/null` для юніт-файлу, що робить його недоступним для `systemd`. Це запобігає запуску сервісу навіть вручну або як залежність іншого сервісу. Використовуйте з обережністю!*

8. **Скасувати маскування сервісу:**
   ```bash
   sudo systemctl unmask apache2.service
   ```
   *Команда `unmask` видаляє символічне посилання, створене `mask`, дозволяючи сервісу знову функціонувати.*
