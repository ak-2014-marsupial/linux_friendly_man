Команда `at` (від англ. "at a specific time") використовується для планування виконання команд або скриптів один раз у вказаний час у майбутньому. На відміну від `cron`, який призначений для регулярних повторюваних завдань, `at` ідеально підходить для одноразових відкладених операцій.

#### **Базовий синтаксис**

```bash
at [-q queue] [-f file] TIME
```

*   **`at TIME`**: Запускає інтерактивний режим, де ви вводите команди, які потрібно виконати. Завершується введенням `Ctrl+D`.
*   **`at -f file TIME`**: Виконує команди, що містяться у вказаному файлі.

---

### **Основні концепції**

*   **Завдання (Job)**: Команда або набір команд, які ви плануєте виконати. Кожне завдання отримує унікальний ідентифікатор (job ID).
*   **Черга (Queue)**: Завдання `at` розміщуються в чергах. За замовчуванням використовується черга `a`. Черга `b` зарезервована для `batch` (див. нижче). Інші літери можуть використовуватися для визначення пріоритету (чим ближче до `z`, тим нижчий пріоритет).
*   **Специфікація часу (TIME)**: `at` підтримує дуже гнучкі формати часу.

---

### **Специфікація часу (TIME)**

`at` розуміє багато різних форматів часу, що робить його дуже зручним у використанні.

| Формат | Приклад | Пояснення |
| :--- | :--- | :--- |
| **Абсолютний час** | `at 10:30` | Запустити о 10:30 сьогодні. Якщо цей час вже минув, то завтра. |
| | `at 10:30 AM Jan 24` | Запустити 24 січня о 10:30 ранку. |
| | `at 14:00 2025-12-25` | Запустити 25 грудня 2025 року о 14:00. |
| **Відносний час** | `at now + 5 minutes` | Запустити через 5 хвилин від поточного моменту. |
| | `at now + 1 hour` | Запустити через 1 годину. |
| | `at now + 2 days` | Запустити через 2 дні. |
| | `at now + 1 week` | Запустити через 1 тиждень. |
| **Ключові слова** | `at tomorrow` | Запустити о тій самій годині завтра. |
| | `at noon` | Запустити о 12:00 дня. |
| | `at midnight` | Запустити о 00:00 ночі. |
| | `at teatime` | Запустити о 16:00 (4 PM). |

---

### **Основні команди `at` та `atq`/`atrm`**

| Команда | Призначення |
| :--- | :--- |
| **`at TIME`** | Планує виконання команд у вказаний час. Після введення команди `at TIME`, ви переходите в інтерактивний режим, де вводите команди, які потрібно виконати. Завершується введенням `Ctrl+D`. |
| **`atq`** або **`at -l`** | Виводить список усіх запланованих завдань у черзі поточного користувача. |
| **`atrm JOB_ID`** або **`at -d JOB_ID`** | Видаляє заплановане завдання з черги за його ідентифікатором (JOB_ID). |
| **`batch`** або **`at -q b TIME`** | Планує виконання команд, коли середнє навантаження на систему (load average) опуститься нижче 1.5 (або іншого значення, визначеного в `/etc/at.conf`). Використовується для некритичних завдань, які не повинні перевантажувати систему. |

---

### **Приклади використання**

1.  **Запланувати команду на виконання через 10 хвилин:**
    ```bash
    at now + 10 minutes
    echo "Привіт, світ!" > /tmp/hello.txt
    Ctrl+D
    ```
    *Після введення `Ctrl+D` ви побачите повідомлення про ідентифікатор завдання, наприклад: `job 5 at 2025-10-22 15:45`.*

2.  **Запланувати виконання скрипта завтра о 08:00 ранку:**
    Припустимо, у вас є скрипт `/home/user/backup.sh`.
    ```bash
    at 08:00 tomorrow -f /home/user/backup.sh
    ```
    *Або в інтерактивному режимі:*
    ```bash
    at 08:00 tomorrow
    /home/user/backup.sh
    Ctrl+D
    ```

3.  **Переглянути список запланованих завдань:**
    ```bash
    atq
    # Або
    at -l
    ```
    *Вивід може виглядати так:*
    ```
    5       2025-10-22 15:45 a user
    6       2025-10-23 08:00 a user
    ```

4.  **Видалити заплановане завдання:**
    Щоб видалити завдання з ID 5:
    ```bash
    atrm 5
    # Або
    at -d 5
    ```

5.  **Запланувати завдання, яке виконається, коли система буде менш завантажена:**
    ```bash
    batch
    echo "Це завдання виконається, коли система буде вільна." >> /var/log/batch_jobs.log
    Ctrl+D
    ```

---

### **Контроль доступу (`/etc/at.allow` та `/etc/at.deny`)**

Доступ до команди `at` контролюється файлами `/etc/at.allow` та `/etc/at.deny`.

*   **`/etc/at.allow`**: Якщо цей файл існує, тільки користувачі, перелічені в ньому, можуть використовувати `at`. Якщо користувач не вказаний у цьому файлі, він не може використовувати `at`.
*   **`/etc/at.deny`**: Якщо `/etc/at.allow` не існує, тоді всі користувачі, які не перелічені в `/etc/at.deny`, можуть використовувати `at`. Якщо `/etc/at.deny` порожній, то всі користувачі можуть використовувати `at`.

**Важливо:** Якщо обидва файли відсутні, тільки суперкористувач (root) може використовувати `at`.

---

### **Змінні середовища**

Коли `at` виконує завдання, воно успадковує змінні середовища з моменту створення завдання. Це означає, що якщо ви покладаєтеся на певні змінні (наприклад, `PATH`), переконайтеся, що вони встановлені правильно, коли ви плануєте завдання. Для скриптів краще використовувати повні шляхи до команд або явно встановлювати `PATH` всередині скрипта.