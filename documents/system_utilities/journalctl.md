Команда `journalctl` (journal control) — це інструмент для перегляду та аналізу логів (журналів), зібраних `systemd-journald`, централізованою системою логування в сучасних дистрибутивах Linux (Ubuntu, Fedora, CentOS 7+, Arch Linux тощо).

`systemd-journald` збирає логи з ядра, системних сервісів, додатків та інших джерел у єдиний структурований формат, що робить `journalctl` набагато потужнішим інструментом, ніж традиційний перегляд текстових файлів у `/var/log`.

#### **Базовий синтаксис**

```bash
journalctl [КЛЮЧІ] [ФІЛЬТРИ]
```
*   `[КЛЮЧІ]` — додаткові параметри, що змінюють поведінку команди (наприклад, `--follow`, `--since`).
*   `[ФІЛЬТРИ]` — критерії для відбору логів (наприклад, `-u nginx.service`, `_PID=1234`).

---

### **Основні ключі (прапори)**

Ключі дозволяють контролювати вивід `journalctl` та його поведінку.

| Ключ | Повна назва | Опис | Приклад |
| :--- | :--- | :--- | :--- |
| `-f` | `--follow` | Слідкувати за логами в реальному часі, виводячи нові записи по мірі їх надходження (аналогічно `tail -f`). | `journalctl -f` |
| `-e` | `--pager-end` | Переходить до кінця журналу в пейджері (зазвичай `less`), показуючи найновіші записи. | `journalctl -e` |
| `-n N` | `--lines=N` | Показати останні `N` рядків логів. За замовчуванням показує 10 рядків. | `journalctl -n 20` |
| `-r` | `--reverse` | Показати логи у зворотному хронологічному порядку (найновіші записи спочатку). | `journalctl -r` |
| `-b [ID]` | `--boot=[ID]` | Показати логи для конкретного завантаження системи. `-b` без аргументів показує поточне завантаження. `-b 0` — поточне, `-b -1` — попереднє, `-b -2` — передостаннє тощо. | `journalctl -b -1` |
| `-k` | `--dmesg` | Показати тільки повідомлення ядра (аналог команди `dmesg`). | `journalctl -k` |
| `-p РІВЕНЬ` | `--priority=РІВЕНЬ` | Фільтрувати за рівнем важливості. Рівні: `emerg` (0), `alert` (1), `crit` (2), `err` (3), `warning` (4), `notice` (5), `info` (6), `debug` (7). Можна вказувати назву або число. | `journalctl -p err` |
| `-o ФОРМАТ` | `--output=ФОРМАТ` | Змінити формат виводу. Популярні формати: `short` (стандартний), `short-iso`, `json`, `json-pretty`, `cat` (тільки повідомлення). | `journalctl -o json-pretty` |
| | `--no-pager` | Вивести всі логи без використання пейджера, одразу в консоль. Корисно для скриптів. | `journalctl --no-pager` |
| `-x` | `--catalog` | Додати пояснювальні тексти до деяких повідомлень журналу, якщо вони доступні в каталозі `systemd`. | `journalctl -x -p err` |
| | `--list-boots` | Показати список усіх завантажень системи, які зберігаються в журналі, з їхніми індексами та часовими мітками. | `journalctl --list-boots` |
| | `--utc` | Відображати час у форматі UTC (Coordinated Universal Time) замість локального часу. | `journalctl --utc` |
| | `--disk-usage` | Показати загальний обсяг дискового простору, який використовують файли журналу. | `journalctl --disk-usage` |
| | `--vacuum-size=SIZE` | Зменшити розмір журналу до вказаного `SIZE` (наприклад, `100M`, `1G`). Видаляє найстаріші записи. | `sudo journalctl --vacuum-size=500M` |
| | `--vacuum-time=TIME` | Видалити записи журналу, старіші за вказаний `TIME` (наприклад, `1year`, `2weeks`). | `sudo journalctl --vacuum-time=3months` |

---

### **Фільтрація логів**

`journalctl` дозволяє фільтрувати записи за різними полями метаданих, що робить пошук дуже гнучким.

*   **За юнітом `systemd` (`-u` або `--unit`):**
    Цей фільтр дозволяє переглядати логи, що стосуються конкретного юніта `systemd` (наприклад, сервісу, сокета, таймера).
    ```bash
    journalctl -u nginx.service
    # Або без розширення .service
    journalctl -u sshd
    ```

*   **За часом:**
    Використовуються ключі `--since` та `--until`. Формати часу гнучкі (наприклад, "2023-10-26 14:00:00", "yesterday", "1 hour ago").
    ```bash
    # Логи за останню годину
    journalctl --since "1 hour ago"

    # Логи за сьогодні
    journalctl --since today

    # Логи за конкретний період
    journalctl --since "2023-10-26 14:00:00" --until "2023-10-26 15:00:00"

    # Логи з вчора до зараз
    journalctl --since yesterday
    ```

*   **За ідентифікатором процесу (PID), користувача (UID) або групи (GID):**
    ```bash
    journalctl _PID=1234
    journalctl _UID=1000
    journalctl _GID=100
    ```

*   **За іменем виконуваного файлу:**
    ```bash
    journalctl _EXE=/usr/bin/gnome-shell
    ```

*   **За шляхом до юніта systemd:**
    ```bash
    journalctl _SYSTEMD_UNIT=user@1000.service
    ```

*   **За повідомленням (повний текст або частина):**
    ```bash
    journalctl MESSAGE="Failed to start"
    ```

*   **Комбінування фільтрів:**
    Можна використовувати кілька фільтрів одночасно. `journalctl` покаже записи, які відповідають *усім* вказаним фільтрам.
    ```bash
    # Помилки сервісу nginx за останню добу
    journalctl -u nginx.service -p err --since yesterday

    # Логи ядра з попереднього завантаження з рівнем критичності 'crit' або вище
    journalctl -b -1 -k -p crit
    ```

---

### **Приклади використання**

1.  **Переглянути всі логи, починаючи з найновіших, і одразу перейти в кінець:**
    ```bash
    journalctl -r -e
    ```

2.  **Слідкувати за логами конкретного сервісу в реальному часі:**
    ```bash
    journalctl -f -u apache2.service
    ```

3.  **Показати тільки помилки та більш критичні повідомлення з поясненнями:**
    ```bash
    journalctl -p err -x
    ```

4.  **Переглянути логи з попереднього завантаження системи, якщо вона аварійно завершила роботу:**
    ```bash
    journalctl -b -1
    ```
    *Це дуже корисно для діагностики проблем після збоїв.*

5.  **Показати список усіх доступних завантажень системи:**
    ```bash
    journalctl --list-boots
    ```
    *Вивід покаже індекс завантаження (`-b ID`), його ID та часові мітки.*

6.  **Переглянути логи у форматі JSON для подальшої обробки скриптами:**
    ```bash
    journalctl -u systemd-networkd -o json-pretty --since "1 hour ago"
    ```

7.  **Очистити старі записи журналу, залишивши лише за останні 7 днів:**
    ```bash
    sudo journalctl --vacuum-time=7d
    ```
    *Використовуйте з обережністю, оскільки це видаляє логи без можливості відновлення.*

8.  **Очистити записи журналу, щоб загальний розмір не перевищував 1 ГБ:**
    ```bash
    sudo journalctl --vacuum-size=1G
    ```

`journalctl` — це потужний та гнучкий інструмент, який є стандартом для роботи з логами в сучасних Linux-системах. Його вміле використання значно спрощує діагностику та моніторинг системи.
