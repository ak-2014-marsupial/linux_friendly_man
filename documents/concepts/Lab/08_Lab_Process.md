# Лабораторна робота: Процеси в Linux

## Частина 1: Знайомство з утилітами top, ps, pstree, lsof, fuser

### 1. Встановлення `lsof`
Команда `sudo yum install lsof` використовується для встановлення утиліти `lsof`.
- `sudo`: Виконує команду з правами суперкористувача (адміністратора).
- `yum`: Менеджер пакетів для CentOS/RHEL, який завантажує та встановлює програмне забезпечення.
- `install`: Команда для `yum`, що вказує на необхідність встановлення пакета.
- `lsof`: Назва пакета. `lsof` (LiSt Open Files) — це утиліта, яка показує, які файли використовуються якими процесами.

### 2. Робота з `top`
`top` — це інтерактивна утиліта для моніторингу процесів та ресурсів системи в реальному часі.

- **Процес, який споживає найбільше ресурсів:** У вікні `top` процеси за замовчуванням відсортовані за використанням CPU (`%CPU`). Процес у верхній частині списку є найбільшим споживачем процесорного часу. Щоб сортувати за пам'яттю, можна натиснути `Shift+M`.
- **Кількість вільної пам'яті:** У верхній частині виводу `top` є рядок `MiB Mem`. Значення навпроти `free` показує кількість вільної оперативної пам'яті.
- **Завантаженість процесора:**
    - **В цілому:** Рядок `%Cpu(s)` показує загальне завантаження: `us` (користувацькі процеси), `sy` (ядро), `id` (простій) і т.д.
    - **Кожного ядра окремо:** Потрібно натиснути клавішу `1`, щоб переключитися між загальним та детальним видом завантаження по кожному ядру CPU.

### 3. Робота з `ps`
`ps aux` — команда для отримання детального списку всіх процесів, що запущені в системі.
- `a`: Показує процеси всіх користувачів.
- `u`: Надає детальний вивід (користувач, PID, %CPU, %MEM, і т.д.).
- `x`: Включає процеси, що не прив'язані до терміналу.

Щоб знайти процеси, пов'язані з SSH-сервером, використовуйте `grep`:
```bash
ps aux | grep sshd
```
Ця команда фільтрує вивід `ps aux` і показує лише ті рядки, що містять `sshd`.

### 4. Робота з `pstree`
`pstree` показує процеси у вигляді дерева. Це дозволяє візуально відстежити, який процес породив інший. Коренем дерева зазвичай є процес `systemd` (або `init`) з PID 1.

### 5. Аналіз `visudo`
- **5.1 `visudo`:** Це безпечний спосіб редагування файлу `/etc/sudoers`, який визначає права доступу для команди `sudo`. `visudo` блокує файл та перевіряє синтаксис перед збереженням, щоб уникнути помилок, які можуть заблокувати доступ до системи.
- **5.2 Пошук файлу:** Коли `visudo` запущено в одному терміналі, в іншому можна виконати команду `lsof | grep visudo` або `ps aux | grep visudo`, щоб знайти PID процесу, а потім `lsof -p <PID>`. У виводі `lsof` буде видно, що процес `visudo` працює з файлом `/etc/sudoers.tmp`, а після збереження — з `/etc/sudoers`.

---

## Частина 2: Запуск та зупинка процесів

1.  **`ping localhost` та `Ctrl+C`:**
    - `ping localhost`: Запускає процес, який безперервно надсилає ICMP-запити на локальну машину.
    - `Ctrl+C`: Надсилає процесу сигнал `SIGINT` (Interrupt). За замовчуванням цей сигнал завершує роботу процесу.

2.  **`ping localhost` та `Ctrl+Z`:**
    - `Ctrl+Z`: Надсилає процесу сигнал `SIGTSTP` (Terminal Stop). Цей сигнал призупиняє процес і переводить його у фоновий режим.
    - `ps aux | grep ping`: У виводі `ps` у колонці `STAT` для цього процесу буде статус `T`, що означає "зупинений" (Traced or stopped).

3.  **Повернення процесу (`fg`):**
    - `fg`: Команда "foreground" повертає останній призупинений процес в інтерактивний режим. Процес `ping` продовжить свою роботу з того місця, де зупинився (значення `icmp_seq` продовжить інкрементуватися).

4.  **Фоновий запуск та перенаправлення:**
    - `ping localhost >> /tmp/ping.log &`:
        - `&`: Запускає команду одразу у фоновому режимі.
        - `>> /tmp/ping.log`: Перенаправляє стандартний вивід (stdout) у файл `/tmp/ping.log` в режимі дозапису.
    - `tail -f /tmp/ping.log`: Утиліта `tail` з прапором `-f` (follow) дозволяє спостерігати за додаванням нових рядків у файл в реальному часі.

5.  **Зупинка процесу (`SIGSTOP`):**
    - `kill -SIGSTOP <PID>` або `kill -19 <PID>`: Надсилає процесу сигнал `SIGSTOP`, який безумовно "заморожує" процес. Вивід у файлі `/tmp/ping.log` припиниться.

6.  **Відновлення процесу (`SIGCONT`):**
    - `kill -SIGCONT <PID>` або `kill -18 <PID>`: Надсилає сигнал `SIGCONT`, який відновлює роботу зупиненого процесу. Вивід у файлі `/tmp/ping.log` продовжиться.

7.  **Сигнали `SIGTERM` та `SIGKILL`:**
    - `Ctrl+Z` призупиняє процеси `top`.
    - `kill -15 <PID>` (або `kill <PID>`): Надсилає сигнал `SIGTERM` (Terminate). Це "ввічливий" запит на завершення. Процес може перехопити цей сигнал, щоб коректно завершити роботу (зберегти дані, закрити файли).
    - Після `kill -15 PID2` та `kill -15 PID3` відповідні процеси `top` зникнуть зі списку `ps`.

8.  **Повернення `top`:**
    - `fg`: Повертає перший призупинений `top` (PID1) в інтерактивний режим. У `ps` його статус зміниться з `T` на `R` (Running).

9.  **Сигнал `SIGKILL`:**
    - `kill -9 <PID1>`: Надсилає сигнал `SIGKILL` (Kill). Цей сигнал неможливо перехопити чи проігнорувати. Система негайно та примусово завершує процес. Це "останній засіб", коли процес не реагує на `SIGTERM`.

10. **Вбивство батьківського процесу:**
    - `pstree` покаже, що процеси `ping` були запущені з вашого поточного сеансу оболонки (наприклад, `bash`).
    - Якщо надіслати `SIGKILL` батьківському процесу (`bash`), всі його дочірні процеси (включно з `ping`) також будуть завершені.

11. **Осиротілі процеси:**
    - Якщо батьківський процес завершується, а дочірні продовжують працювати, вони стають "осиротілими".
    - В Linux такі процеси "усиновлюються" процесом `systemd` (або `init`) з PID 1. `pstree` покаже, що новим батьком для `ping` став `systemd`.

---

## Частина 3: Підказки та деталізація

### Команда `top`
- **Сортування:**
    - `Shift+M`: Сортувати за використанням пам'яті (`%MEM`).
    - `Shift+T`: Сортувати за часом роботи (`TIME+`).
    - `Shift+P`: Сортувати за використанням CPU (`%CPU`, стандартне значення).
- **Додати Parent PID:** Натисніть `f`, стрілками виберіть `PPID`, натисніть `d` або `пробіл`, щоб додати, `Esc` для виходу.
- **Надіслати сигнал з `top`:** Натисніть `k`, введіть PID процесу, який потрібно завершити, натисніть `Enter`, потім введіть номер сигналу (наприклад, `15` для `SIGTERM` або `9` для `SIGKILL`) і знову `Enter`.

### Команда `ps`
- **Вивести стовпці `PID, Parent PID, Command, CPU, Memory`:**
  ```bash
  ps -o pid,ppid,comm,pcpu,pmem
  ```
  - `-o`: Дозволяє вказати власний формат виводу.
- **Сортування за CPU (зростання):**
  ```bash
  ps -o pid,ppid,comm,pcpu,pmem --sort=pcpu
  ```
- **Сортування за пам'яттю (зменшення):**
  ```bash
  ps -o pid,ppid,comm,pcpu,pmem --sort=-pmem
  ```
  (знак `-` перед назвою колонки означає сортування за зменшенням).

### Команда `pstree`
- **Дерево з PID:**
  ```bash
  pstree -p
  ```
- **Дерево, відсортоване за PID:**
  ```bash
  pstree -n
  ```
- **Підсвітити поточний процес та його предків:**
  ```bash
  pstree -h
  ```

### Файли та процеси
- **Вивести процеси, які працюють з файлами (`lsof`):**
  ```bash
  lsof
  ```
  Ця команда виведе дуже довгий список всіх відкритих файлів та процесів, що їх використовують.
- **Знайти процеси `ping`, які працюють з файлом `/tmp/ping.log`:**
  ```bash
  lsof /tmp/ping.log
  ```
  Або можна відфільтрувати загальний вивід:
  ```bash
  lsof | grep ping
  ```
- **Знайти всі процеси, що працюють з файлом `/tmp/ping.log` (`fuser`):**
  ```bash
  fuser -v /tmp/ping.log
  ```
  `fuser` показує PID процесів, що використовують вказаний файл або файлову систему. Прапор `-v` (verbose) дає більш детальний вивід.
