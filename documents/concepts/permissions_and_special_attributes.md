# Права доступу в Linux

## 1. Стандартні права доступу (r, w, x)

Кожен файл і каталог у Linux має три набори прав доступу для трьох категорій користувачів:
- **Власник (user)**: Творець файлу.
- **Група (group)**: Група користувачів, що мають спільні права.
- **Всі інші (others)**: Будь-який інший користувач системи.

| Право доступу | Звичайний файл (-) | Каталог (d) |
| :--- | :--- | :--- |
| **r (read)** | Дозволяє читати вміст файлу. | Дозволяє переглядати вміст каталогу (використовувати `ls`). |
| **w (write)** | Дозволяє змінювати, видаляти або перезаписувати вміст файлу. | Дозволяє створювати, видаляти та перейменовувати файли в цьому каталозі. |
| **x (execute)** | Дозволяє виконувати файл як програму. | Дозволяє входити в каталог (використовувати `cd`) та отримувати доступ до його вмісту. Без цього права `r` для каталогу є марним. |

*Приклади у `ls -l`:*
- `rwxr--r--`: Власник може читати, писати та виконувати. Група та інші можуть тільки читати.
- `drwxrw-r--`: Каталог. Власник має повні права, група може читати та писати, а інші — тільки читати.

## 2. Права на видалення файлів

Щоб видалити файл, вам потрібні права не на сам файл, а на **батьківський каталог**, у якому він знаходиться.

**Необхідні права на каталог:**
1.  **Право на запис (w)**: Дозволяє змінювати вміст каталогу, що включає створення, **видалення** та перейменування файлів.
2.  **Право на виконання (x)**: Дозволяє "увійти" в каталог, щоб отримати доступ до його вмісту. Без цього права ви не зможете навіть побачити файл, не кажучи вже про його видалення.

> **Аналогія:** Уявіть файл як книгу на полиці в кімнаті (каталозі). Щоб прибрати книгу з полиці (видалити файл), вам потрібен дозвіл на вхід до кімнати (`x`) та дозвіл переставляти речі в цій кімнаті (`w`). Вам не потрібен дозвіл на читання самої книги.

## 3. Спеціальні права доступу

Ці права розширюють функціональність стандартних. Вони позначаються літерами `s` та `t`.

### Важливе зауваження: `s`/`S` та `t`/`T`

Регістр літери спеціального права (`s` або `S`, `t` або `T`) показує, чи встановлено для цього об'єкта біт виконання (`x`).

-   **Мала літера (`s`, `t`)**: Встановлено і спеціальний біт, і біт виконання `x`.
    -   `-rwsr-xr-x`: SUID та `x` для власника.
-   **Велика літера (`S`, `T`)**: Спеціальний біт встановлено, а біт виконання `x` — **ні**.
    -   `-rwSr--r--`: SUID встановлено, але файл не є виконуваним для власника. Найчастіше це безглуздо або є помилкою.
    -   `drwxrwx--T`: Sticky bit встановлено, але у "інших" немає права на вхід (`x`), що робить каталог для них марним.

### SUID (Set User ID)
- **Як виглядає**: `s` на місці `x` для власника. Наприклад, `-rwsr-xr-x`.
- **Призначення**: Коли виконуваний файл зі встановленим SUID запускається, він виконується з правами **власника файлу**, а не з правами користувача, який його запустив.
- **Основний приклад**: Команда `passwd` (`/usr/bin/passwd`, права `-rwsr-xr-x`). Вона повинна мати можливість змінювати системний файл `/etc/shadow`, який доступний тільки для `root`. `passwd` належить `root` і має SUID-біт. Коли звичайний користувач запускає `passwd`, вона тимчасово отримує права `root` для зміни файлу паролів.
- **Інші приклади**:
    - `ping` (`/bin/ping`, права `-rwsr-xr-x`): На багатьох системах `ping` має SUID, оскільки для надсилання ICMP-пакетів потрібні права `root`.
    - `su` (`/bin/su`, права `-rwsr-xr-x`): Дозволяє користувачеві тимчасово стати іншим користувачем (часто `root`), що є класичним прикладом підвищення привілеїв.
    - `mount` (`/bin/mount`, права `-rwsr-xr-x`): Дозволяє звичайним користувачам монтувати пристрої, зазначені в `/etc/fstab`, без необхідності вводити пароль `root`.

### SGID (Set Group ID)
- **Як виглядає**: `s` на місці `x` для групи. Наприклад, `-rwxrwsr-x`.
- **Призначення**:
    - **На виконуваних файлах**: Запускає файл з правами **групи-власника** файлу.
    - **На каталогах**: Усі нові файли та підкаталоги, створені всередині, **успадковують групу-власника** батьківського каталогу, а не основну групу користувача, який їх створив. Це дуже корисно для спільної роботи в команді.
- **Приклад на каталозі**: Каталог для групового проєкту (`/home/projects/shared`, права `drwxrwsr-x`). Якщо встановити SGID-біт, усі нові файли, створені в ньому, автоматично належатимуть групі `projects`, що спрощує спільний доступ.
- **Інші приклади**:
    - **На файлі**: Команда `wall` (`/usr/bin/wall`, права `-rwxr-sr-x`). Вона дозволяє надіслати повідомлення на термінали всіх залогінених користувачів і може використовувати SGID (`tty`), щоб отримати право запису на їхні термінали.
    - **На каталозі (детальніше)**: Уявіть каталог логів `/var/log/nginx/` (права `drwxr-s---`). Якщо він належить групі `adm` і на ньому стоїть SGID, то всі нові лог-файли, що створюються `nginx`, автоматично належатимуть групі `adm`. Це дозволяє системним адміністраторам, що входять до групи `adm`, читати ці логи, навіть якщо `nginx` працює від іншого користувача.

### Sticky Bit (біт-«липучка»)
- **Як виглядає**: `t` на місці `x` для "інших". Наприклад, `drwxrwxrwt`.
- **Призначення**: Працює тільки на **каталогах**. Він запобігає видаленню або перейменуванню файлів іншими користувачами, навіть якщо у них є права на запис у цей каталог. Видаляти або перейменовувати може тільки **власник файлу**, власник каталогу або `root`.
- **Приклади**:
    1.  **Каталог `/tmp`**: Це класичний приклад (`/tmp`, права `drwxrwxrwt`). `/tmp` — загальнодоступний каталог, де будь-який користувач може створювати тимчасові файли. Без sticky bit будь-який користувач міг би видалити файли, створені іншими. Зі sticky bit ви можете керувати тільки своїми файлами.
    2.  **Спільні каталоги**: У середовищах, де користувачі завантажують файли в спільну папку, sticky bit захищає файли від видалення іншими учасниками.
- **Як встановити**:
    ```bash
    # Встановити sticky bit
    chmod +t /path/to/directory

    # Видалити sticky bit
    chmod -t /path/to/directory
    ```

## 4. Права за замовчуванням та `umask`

Уявіть `umask` як фільтр або трафарет, що накладається на максимально можливі права під час створення файлу чи каталогу.

#### Крок 1: Максимальні права за замовчуванням

Коли створюється новий об'єкт, система спочатку припускає, що він матиме такі права:
-   **Для файлів**: `666` (`rw-rw-rw-`). Усі можуть читати та змінювати.
-   **Для каталогів**: `777` (`rwxrwxrwx`). Усі можуть читати, змінювати та входити в каталог.

#### Крок 2: `umask` визначає, що потрібно "відняти"

Тепер у гру вступає `umask`. Його значення говорить, які права потрібно **заборонити** (прибрати) з максимальних.

Візьмемо стандартний `umask 022`:

-   **Перша цифра (`0`)**: стосується **власника (user)**. `0` означає, що у власника **нічого не віднімаємо**.
-   **Друга цифра (`2`)**: стосується **групи (group)**. `2` — це числове значення права на запис (`w`). Це означає, що у групи потрібно **відняти право на запис**.
-   **Третя цифра (`2`)**: стосується **всіх інших (others)**. `2` також означає, що у всіх інших потрібно **відняти право на запис**.

#### Крок 3: Обчислюємо підсумкові права

-   **Для нового файлу (база `666`):**
    -   Власник: `6` (rw-) мінус `0` = `6` (rw-)
    -   Група: `6` (rw-) мінус `2` (w) = `4` (r--)
    -   Інші: `6` (rw-) мінус `2` (w) = `4` (r--)
    -   **Результат: `644` (`rw-r--r--`)**

-   **Для нового каталогу (база `777`):**
    -   Власник: `7` (rwx) мінус `0` = `7` (rwx)
    -   Група: `7` (rwx) мінус `2` (w) = `5` (r-x)
    -   Інші: `7` (rwx) мінус `2` (w) = `5` (r-x)
    -   **Результат: `755` (`rwxr-xr-x`)**

**Підсумок:** `umask 022` — це безпечне налаштування, яке за замовчуванням дозволяє власнику робити все, а всім іншим — тільки читати файли та заходити в каталоги, але не змінювати їх.



## 5. Права для інших типів файлів

- **Символічне посилання (l)**: Права доступу на самому посиланні (`rwxrwxrwx`) ігноруються. Фактичні дозволи визначаються на **цільовому файлі або каталозі**, на який вказує посилання.
- **Файли пристроїв (c, b)**:
    - `c` (character device): Символьні пристрої (наприклад, `/dev/tty`, `/dev/null`). Права контролюють, хто може читати або записувати в пристрій.
    - `b` (block device): Блокові пристрої (наприклад, `/dev/sda`). Права на них критично важливі для безпеки, оскільки прямий доступ може пошкодити файлову систему. Зазвичай доступ є тільки у `root`.

## 6. Рідкісні комбінації прав

### Для каталогів
Права зі значенням менше `5` (`r-x`) для каталогів вважаються малокорисними, оскільки для роботи з вмістом потрібні права на вхід (`x`) та читання (`r`).
- `---` (0): Немає прав.
- `--x` (1): Можна увійти в каталог (`cd`), але не можна подивитися його вміст (`ls`).
- `-w-` (2): Марно. Не можна увійти в каталог, щоб щось у ньому створити.
- `r--` (4): Можна подивитися список файлів, але не можна в них увійти.

### Для файлів
На відміну від каталогів, для звичайних файлів права `1` та `2` можуть мати сенс.
- **`--x` (1)**: Файл можна виконати як скрипт, але не можна прочитати його код. Корисно для захисту інтелектуальної власності або приховування логіки.
- **`-w-` (2)**: У файл можна писати, але не можна його читати. Використовується для файлів-журналів (логів), куди процеси тільки дописують інформацію.

## 7. Керування правами та атрибутами

Для зміни прав та власників використовуються команди `chmod`, `chown` та `chgrp`.

### `chmod`: Зміна прав доступу

`chmod` (change mode) може працювати у двох режимах: символьному та числовому.

#### Символьний режим (рекомендується для точкових змін)

Він використовує літери для позначення, чиї права змінюються, оператор та самі права.

-   **Користувачі**: `u` (user), `g` (group), `o` (others), `a` (all - всі).
-   **Оператори**: `+` (додати), `-` (відняти), `=` (встановити точно).
-   **Права**: `r` (read), `w` (write), `x` (execute), `s` (SUID/SGID), `t` (sticky).

**Приклади:**

```bash
# Додати право на виконання для власника файлу
chmod u+x script.sh

# Відняти право на запис для групи та інших
chmod go-w config.cfg

# Встановити права "тільки читання" для всіх
chmod a=r report.docx

# Рекурсивно дати всім право на читання та вхід у каталог
chmod -R a+rX public_data/
# (Зверніть увагу на 'X' - вона дає право 'x' тільки каталогам і файлам, де воно вже є у когось)

# Встановити SUID-біт на виконуваний файл
chmod u+s /usr/bin/my_app

# Встановити SGID-біт на каталог для спільної роботи
chmod g+s /home/shared/project_files

# Встановити sticky bit на спільний каталог
chmod +t /var/uploads
```

#### Числовий (вісімковий) режим (рекомендується для повного встановлення прав)

Кожному праву відповідає число: `r=4`, `w=2`, `x=1`. Вони підсумовуються для кожної категорії (власник, група, інші).

-   `7` = `4+2+1` = `rwx`
-   `6` = `4+2` = `rw-`
-   `5` = `4+1` = `r-x`
-   `4` = `4` = `r--`
-   `0` = `---`

Спеціальні права також мають числа: SUID = `4`, SGID = `2`, Sticky = `1`. Вони ставляться **перед** основною трійкою чисел.

**Приклади:**

```bash
# Встановити стандартні права для веб-сервера:
# Власник - rwx, група - r-x, інші - r-x
chmod 755 script.cgi

# Встановити права "читання/запис" для власника та "тільки читання" для інших
chmod 644 index.html

# Рекурсивно встановити права на каталог та весь його вміст
chmod -R 750 /secure_data

# Встановити SUID: 4000 + 755 = 4755
# Права: rwsr-xr-x
chmod 4755 /usr/bin/my_app

# Встановити SGID: 2000 + 775 = 2775
# Права: rwxrwsr-x
chmod 2775 /home/shared/project_files

# Встановити Sticky bit: 1000 + 777 = 1777
# Права: rwxrwxrwt
chmod 1777 /tmp/shared_dir
```

### `chown`: Зміна власника та групи

`chown` (change owner) змінює власника та/або групу файлу чи каталогу.

**Приклади:**

```bash
# Змінити власника файлу на 'alice'
chown alice report.pdf

# Змінити групу файлу на 'developers'
chown :developers app.log
# (Зверніть увагу на двокрапку)

# Змінити і власника ('bob'), і групу ('editors')
chown bob:editors document.txt

# Рекурсивно змінити власника та групу для всього каталогу
chown -R www-data:www-data /var/www/html
```

### `chgrp`: Зміна групи

`chgrp` (change group) використовується тільки для зміни групи. Команда `chown` є більш універсальною, але `chgrp` все ще широко використовується.

**Приклади:**

```bash
# Змінити групу файлу на 'admins'
chgrp admins server.conf

# Рекурсивно змінити групу для каталогу
chgrp -R testers /srv/qa/
```