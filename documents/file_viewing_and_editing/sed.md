# Посібник з утиліти `sed`

`sed` (Stream Editor) — це потужна утиліта командного рядка для обробки та трансформації тексту. `sed` читає текст рядок за рядком з файлу або стандартного вводу, застосовує до кожного рядка набір команд (скрипт) і виводить результат у стандартний вивід.

### **Ключова концепція**

`sed` працює як "неінтерактивний" текстовий редактор. Ви не відкриваєте файл у редакторі, а натомість надсилаєте йому "потік" тексту та інструкції, що з ним робити. За замовчуванням, `sed` **не змінює оригінальний файл**, а лише друкує змінений текст на екран. Щоб змінити файл, потрібна спеціальна опція.

#### **Базовий синтаксис**

```bash
sed [опції] 'команда' [файл]
команда | sed [опції] 'команда'
```

*   **`'команда'`**: Інструкція, яку `sed` має виконати. Найчастіше це команда заміни `s`.

За замовчуванням, `sed` виводить кожен оброблений рядок. Якщо ваша команда також передбачає вивід (наприклад, `p`), ви отримаєте подвоєний результат.

```bash
# Кожен рядок буде надруковано двічі
sed 'p' /etc/passwd
```
Щоб уникнути цього, використовуйте опцію `-n` (`--quiet`), яка пригнічує автоматичний вивід.

---

### **Команда `s` (substitute) — Заміна тексту**

Це найпоширеніша і найважливіша команда `sed`. Її синтаксис:

```
s/шаблон/заміна/[прапори]
```

*   **`шаблон`**: Регулярний вираз, який потрібно знайти.
*   **`заміна`**: Текст, на який потрібно замінити знайдений шаблон.
*   **`[прапори]`** (необов'язково):
    *   **`g`** (global): Замінити **всі** входження шаблону в рядку, а не лише перше.
    *   **`i`** (ignore-case): Ігнорувати регістр при пошуку шаблону.
    *   **`N`** (число): Замінити лише N-не входження шаблону.

**Розділювач**: Замість `/` можна використовувати майже будь-який інший символ (наприклад, `#`, `|`, `_`). Це зручно, коли ви працюєте з текстом, що містить слеші (наприклад, шляхи до файлів).
`s#/path/to/old#/path/to/new#g`

 | Застосувати від N-ного рядка до кінця файлу. |
| `/шаблон/` | Застосувати до рядків, що відповідають шаблону. |
| `/шаблон1/,/шаблон2/` | Застосувати до діапазону, що починається з рядка, який відповідає `шаблону1`, і закінчується рядком, що відповідає `шаблону2`. |
| `/шаблон/!` | Застосувати до всіх рядків, **окрім** тих, що відповідають шаблону. |


### **Інші корисні команди**

| Команда | Пояснення |
| :--- | :--- |
| **`d`** | **(Delete)**. Видалити весь рядок. |
| **`p`** | **(Print)**. Надрукувати рядок. Зазвичай використовується з опцією `-n`. |
| **`i \текст`** | **(Insert)**. Вставити `текст` перед поточним рядком. |
| **`a \текст`** | **(Append)**. Додати `текст` після поточного рядка. |

### **Основні опції командного рядка**

| Опція | Пояснення |
| :--- | :--- |
| **`-i`** | **(In-place)**. **Змінити файл "на місці"**. **Обережно!** Без цієї опції `sed` лише друкує результат. Рекомендується робити резервну копію: `sed -i.bak 'команда' файл`. |
| **`-n`** | **(No print / Quiet)**. Пригнічує автоматичний друк. За замовчуванням `sed` друкує кожен рядок після обробки. З `-n` він друкуватиме лише те, що ви вкажете командою `p`. |
| **`-e`** | Дозволяє вказати кілька команд. `sed -e 'команда1' -e 'команда2' файл`. |
| **`-r` (`-E`)** | **(Extended Regexp)**. Дозволяє використовувати розширені регулярні вирази (ERE). |
| **`-f [файл]`** | Виконати команди, записані у файлі скриптів. |

---

### **Практичні приклади**

1.  **Замінити перше входження `cat` на `dog` у кожному рядку:**
    ```bash
    sed 's/cat/dog/' my_file.txt
    ```

2.  **Замінити всі входження `cat` на `dog`:**
    ```bash
    sed 's/cat/dog/g' my_file.txt
    ```

3.  **Замінити шлях у файлі конфігурації (використовуючи інший розділювач):**
    ```bash
    sed 's#/var/www/html#/srv/www#g' nginx.conf
    ```

4.  **Змінити файл на місці, створивши резервну копію `config.ini.bak`:**
    ```bash
    sed -i.bak 's/enabled = false/enabled = true/g' config.ini
    ```

5.  **Видалити всі рядки, що містять `DEBUG`:**
    ```bash
    sed '/DEBUG/d' application.log
    ```

6.  **Видалити порожні рядки:**
    ```bash
    sed '/^$/d' text_file.txt
    ```

7.  **Надрукувати лише рядки з 5 по 10 (аналог `head` та `tail`):**
    ```bash
    sed -n '5,10p' large_file.txt
    ```

8.  **Закоментувати рядок, що містить `unstable_feature`:**
    ```bash
    sed '/unstable_feature/s/^/#/' config.js
    # s/^/#/ -> замінити початок рядка (^) на #
    ```

9.  **Вставити текст на початку файлу:**
    ```bash
    sed '1i # This file was automatically updated' script.sh
    ```

10. **Замінити слово "yes" на "no" лише в тих рядках, що містять "answer":**
    ```bash
    sed '/answer/s/\byes\b/no/g' data.txt
    # /answer/ -> Адреса: застосувати команду лише до рядків, що містять "answer".
    # s/\byes\b/no/g -> Команда: замінити всі окремі слова "yes" на "no".
    # \b — це "경계(boundary)", що позначає межу слова.
    ```

11. **Надрукувати діапазон рядків до кінця файлу (символ `$`):**
    ```bash
    sed -n '17,$ p' /etc/passwd
    ```

12. **Надрукувати тільки ті рядки, що відповідають шаблону (починаються на `s`):**
    ```bash
    sed -n '/^s/ p' /etc/passwd
    ```

13. **Використання захоплених груп для зміни порядку слів:**
    ```bash
    echo "first second" | sed -r 's/(\w+) (\w+)/\2 \1/'
    # Вивід: second first
    ```

14. **Редагування файлу на місці зі створенням резервної копії:**
    ```bash
    sed -i.bak 's/old/new/g' filename.txt
    # Файл filename.txt буде змінено, а оригінал збережено у filename.txt.bak
    ```

### **Складніші приклади**

15. **Умовна заміна: додати `00` до номера, якщо він не починається з `60`:**
    ```bash
    # Якщо рядок НЕ відповідає шаблону /^60/, то виконати команду s/.../.../
    sed -r '/^60/! s/^([0-9]{10,12})$/00\\1/' phone_numbers.txt
    ```

16. **Редагування конфігураційного файлу в межах секції:**
    *Завдання: змінити `method=auto` на `method=disabled` тільки в секції `[ipv4]`.*
    ```bash
    sed -i.bak '/^\[ipv4\]/,/^\[/ s/^method=.*/method=disabled/' network.conf
    ```
    *Пояснення: команда `s/.../.../` застосовується до діапазону, що починається з рядка `[ipv4]` і закінчується наступним рядком, що починається з `[` (тобто наступною секцією).*

17. **Покрокова заміна з демонстрацією прапорів `g` та `i`:**
    *Припустимо, файл `test.txt` містить: `System error, system failure.`*
    ```bash
    # Замінить лише перше входження "system" (з урахуванням регістру)
    $ sed 's/system/origin/' test.txt
    > System error, origin failure.

    # Замінити всі входження "system" (з урахуванням регістру)
    $ sed 's/system/origin/g' test.txt
    > System error, origin failure.

    # Замінити всі входження, ігноруючи регістр
    $ sed 's/system/origin/gi' test.txt
    > origin error, origin failure.
    ```

### **`sed` чи `awk`?**

*   **`sed`** ідеально підходить для простих, потокових операцій над рядками: **заміна, видалення, вставка**. Його синтаксис для цих завдань є більш лаконічним.
*   **`awk`** є кращим вибором, коли вам потрібно працювати з **колонками (полями)**, виконувати обчислення, використовувати змінні та писати більш складну логіку.
