Утиліта `find` — це потужний інструмент для пошуку файлів та директорій у файловій системі на основі різноманітних критеріїв.

#### **Базовий синтаксис**

```bash
find [шлях_пошуку] [вираз_пошуку] [дія]
```

*   **`[шлях_пошуку]`**: Директорія, з якої починати пошук (наприклад, `.`, `/`, `~/Documents`).
*   **`[вираз_пошуку]`**: Критерії, за якими шукати файли (ключі).
*   **`[дія]`**: Що робити зі знайденими файлами (наприклад, вивести на екран, видалити, виконати команду).

---

### **Основні ключі для пошуку (детально)**

*   **`-name "шаблон"`**
    Пошук файлів за іменем, **чутливий до регістру**.
    *   **`*`** — метасимвол, що означає будь-яку кількість символів.
    *   **`?`** — метасимвол, що означає рівно один довільний символ.
    *   *Приклад:* `find . -name "*.txt"`

*   **`-iname "шаблон"`**
    Пошук файлів за іменем, **НЕчутливий до регістру**.
    *   *Приклад:* `find . -iname "document*"` знайде `Document.pdf` та `document.txt`.

*   **`-type тип`**
    Пошук за типом об'єкта.
    *   Основні типи:
        *   **`f`** — звичайний файл (file).
        *   **`d`** — директорія (directory).
        *   **`l`** — символічне посилання (symbolic link).

*   **`-size [+|-]N[c,k,M,G]`**
    Пошук файлів за розміром.
    *   Суфікси для одиниць виміру:
        *   **`c`** — байти.
        *   **`k`** — кілобайти.
        *   **`M`** — мегабайти.
        *   **`G`** — гігабайти.
    *   Оператори:
        *   **`+N`** — розмір **більше** ніж N.
        *   **`-N`** — розмір **менше** ніж N.
        *   **`N`** (без оператора) — розмір **точно** N.

*   **`-mtime [+|-]N`**
    Пошук за часом **модифікації** файлу (зміни вмісту).
    *   Одиниця виміру `N` — кількість 24-годинних періодів (діб).
    *   Оператори:
        *   **`+N`** — файл змінювався **більше** ніж N діб тому.
        *   **`-N`** — файл змінювався **менше** ніж N діб тому (тобто, нещодавно).
        *   **`N`** — файл змінювався **рівно** N діб тому.

*   **`-user ім'я`**
    Пошук файлів, власником яких є вказаний користувач.
    *   `ім'я` — це логін користувача (наприклад, `andrew`).
    *   Можна також використовувати числовий ID користувача (UID).

*   **`-perm режим`**
    Пошук файлів за правами доступу.
    *   `режим` — права у вісімковому форматі (наприклад, `644`, `755`).
    *   Префікси:
        *   **`-режим`** — мають бути встановлені **всі** вказані біти прав.
        *   **`/режим`** — має бути встановлений **хоча б один** із вказаних бітів.
        *   (без префікса) — **точна відповідність** прав.

---
### **Дії зі знайденими файлами**

| Дія | Пояснення |
| :--- | :--- |
| **`-print`** | (Дія за замовчуванням) Вивести повний шлях до знайденого файлу на екран. |
| **`-ls`** | Вивести детальну інформацію про файл у форматі команди `ls -lids`. |
| **`-delete`** | Видалити знайдені файли. **Використовуйте з великою обережністю!** |
| **`-exec`** | Виконати зовнішню команду. Деталі див. нижче. |

### **Детально про `-exec`: різниця між `\;` та `+`**

Ключ `-exec` є одним з найпотужніших інструментів `find`. Він дозволяє виконувати довільні системні команди над знайденими файлами.

*   **`{}`** — це спеціальний заповнювач (placeholder), який у команді замінюється на повний шлях до поточного знайденого файлу.

*   **`-exec команда {} \;`**
    *   Крапка з комою `\;` (потрібно екранувати її слешем) означає кінець команди.
    *   Цей синтаксис змушує `find` виконувати команду **окремо для кожного знайденого файлу**. Це надійно, але може бути повільно, якщо файлів дуже багато.

*   **`-exec команда {} +`**
    *   Знак плюса `+` є альтернативою.
    *   `find` збирає список знайдених файлів і передає їх усіх **разом як аргументи** одній команді. Це набагато ефективніше, оскільки команда запускається один раз (або кілька разів), а не для кожного файлу.

**Приклад різниці:**
Якщо `find` знайде `file1.txt`, `file2.txt`, `file3.txt`:
1.  `... -exec rm {} \;` виконає три окремі команди:
    *   `rm ./file1.txt`
    *   `rm ./file2.txt`
    *   `rm ./file3.txt`
2.  `... -exec rm {} +` виконає одну команду:
    *   `rm ./file1.txt ./file2.txt ./file3.txt`

**Коли що використовувати?**
*   Використовуйте **`+`** завжди, коли це можливо (для команд, що можуть приймати багато файлів як аргументи, як `ls`, `grep`, `chmod`, `chown`, `rm`).
*   Використовуйте **`\;`** для команд, які можуть працювати лише з одним файлом за раз, або якщо вам потрібно використовувати `{}` кілька разів у команді (наприклад, `mv {} {}.bak`).

---
### **Розширений список прикладів використання**

#### Простий пошук (за іменем, типом, розміром)
1.  **Знайти файл за точною назвою:**
    ```bash
    find . -name "my_document.odt"
    ```

2.  **Знайти всі файли з розширенням `.log` у системі:**
    ```bash
    find / -type f -name "*.log"
    ```

3.  **Знайти всі директорії з назвою `assets`:**
    ```bash
    find . -type d -name "assets"
    ```

4.  **Знайти файли розміром більше 100 мегабайт:**
    ```bash
    find /home -type f -size +100M
    ```

5.  **Знайти файли розміром від 10 до 20 мегабайт:**
    ```bash
    find . -type f -size +10M -size -20M
    ```

#### Пошук за часом та правами доступу
6.  **Знайти файли, змінені протягом останніх 7 днів:**
    ```bash
    find . -type f -mtime -7
    ```

7.  **Знайти файли, до яких не було доступу більше року (365 днів):**
    ```bash
    find /docs -type f -atime +365
    ```

8.  **Знайти файли з правами доступу `777` (небезпечно):**
    ```bash
    find . -type f -perm 777
    ```

9.  **Знайти файли, які може записувати будь-хто (world-writable):**
    ```bash
    find / -type f -perm /o=w
    ```

#### Приклади з `-exec` (виконання команд)
10. **Знайти всі файли `.sh` і надати їм права на виконання:**
    ```bash
    find . -type f -name "*.sh" -exec chmod +x {} \;
    ```

11. **Знайти всі файли, що належать користувачу `andrew`, і змінити їх власника на `guest` (ефективно):**
    ```bash
    find /data -user andrew -exec chown guest:guest {} +
    ```

12. **Знайти всі файли `.jpg` і перемістити їх у директорію `~/Pictures`:**
    ```bash
    find . -type f -iname "*.jpg" -exec mv {} ~/Pictures/ \;
    ```

13. **Знайти текст "ERROR" у всіх файлах `.log` у директорії `/var/log`:**
    ```bash
    find /var/log -type f -name "*.log" -exec grep -l "ERROR" {} +
    ```

14. **Заархівувати всі файли, старші за 30 днів:**
    ```bash
    find /backups -type f -mtime +30 -exec tar -rvf old_files.tar {} +
    ```

#### Складні комбінації та виключення
15. **Знайти порожні файли та видалити їх (безпечний спосіб):**
    ```bash
    find . -type f -empty -delete
    ```

16. **Знайти файли `.jpg` АБО `.png`:**
    ```bash
    find . -type f \( -name "*.jpg" -o -name "*.png" \)
    ```
    *(Дужки та оператор `-o` (OR) дозволяють комбінувати умови).*

17. **Знайти всі файли, ОКРІМ файлів у директорії `.git`:**
    ```bash
    find . -path ./.git -prune -o -print
    ```
    *(Це стандартний та найнадійніший спосіб виключити директорію з пошуку).*

18. **Знайти всі файли, що НЕ мають розширення `.tmp`:**
    ```bash
    find . -type f -not -name "*.tmp"
    ```

19. **Знайти текст "ERROR" у всіх файлах `.log` в директорії `/var/log` та скопіювати ті файли, де знайдено збіг, до директорії `~/tmp`**
    
    **Варіант 1: Використання `-exec`**
    ```bash
    find /var/log -name "*.log" -exec grep -q "ERROR" {} \; -exec cp {} ~/tmp \;
    ```
    *Пояснення покроково:*
    1.  `find /var/log -name "*.log"` — знаходить усі файли, що закінчуються на `.log`.
    2.  `-exec grep -q "ERROR" {} \;` — для кожного знайденого файлу виконується `grep` у "тихому" режимі (`-q`). Команда `grep` повертає код успіху (0), якщо знаходить текст, і `find` вважає цю дію успішною.
    3.  `-exec cp {} ~/tmp \;` — ця друга дія виконується **тільки для тих файлів**, для яких попередня дія (`grep`) була успішною, тобто копіює файл.

    **Варіант 2: Використання `xargs`**

    Цей підхід використовує конвеєр (pipe `|`) для передачі результатів від однієї команди до іншої. Команда `xargs` будує і виконує команди на основі даних, отриманих зі стандартного вводу.
    ```bash
    find /var/log -name "*.log" -print0 | xargs -0 grep -l --null "ERROR" | xargs -0 cp -t ~/tmp
    ```
    *Пояснення покроково:*
    1.  `find /var/log -name "*.log" -print0` — знаходить файли і виводить їхні імена, розділені спеціальним `null`-символом. Це найнадійніший спосіб передачі імен файлів, які можуть містити пробіли або спеціальні символи.
    2.  `| xargs -0 grep -l --null "ERROR"` — `xargs -0` приймає `null`-розділений список. Для цих файлів запускається `grep`, який шукає "ERROR". Ключ `-l` змушує `grep` виводити лише імена файлів, де знайдено збіг. Ключ `--null` змушує `grep` також використовувати `null`-символ як роздільник для свого виводу.
    3.  `| xargs -0 cp -t ~/tmp` — останній крок. `xargs -0` приймає `null`-розділений список файлів від `grep` і передає його команді `cp`. Ключ `-t ~/tmp` вказує `cp` скопіювати всі отримані файли в директорію `~/tmp`.
