`ufw` (Uncomplicated Firewall) — це **інтерфейс-конфігуратор**. Він читає власні, прості для розуміння, файли конфігурації, які знаходяться переважно в директорії **/etc/ufw/**.

*   Основні файли, які він використовує:
    *   `user.rules` (та `user6.rules` для IPv6): Тут зберігаються правила, які ви додали.
    *   `before.rules` та `after.rules`: Правила, які виконуються до та після ваших основних правил.
    *   `sysctl.conf`: Системні налаштування ядра, пов'язані з мережею.
    *   `/etc/ufw/applications.d/`: Профілі для додатків (наприклад, 'Nginx Full').

Після читання цих файлів `ufw` **генерує** на їх основі складні правила для `iptables` і завантажує їх у ядро.

---

Команда `ufw` (Uncomplicated Firewall) — це простий у використанні інтерфейс для керування брандмауером `iptables` в Linux. `ufw` значно спрощує процес налаштування правил мережевої безпеки і є рекомендованим інструментом для початківців та для швидкого налаштування брандмауера на серверах.

Основна мета `ufw` — надати користувачам простий синтаксис для складних правил `iptables`, не вимагаючи глибоких знань про роботу таблиць та ланцюжків.

### **Базовий синтаксис**

```bash
sudo ufw <команда>
```

---

### **Основні команди**

#### 1. Керування станом брандмауера

| Команда | Опис |
| :--- | :--- |
| `sudo ufw enable` | Увімкнути брандмауер. Правила почнуть діяти. |
| `sudo ufw disable` | Вимкнути брандмауер. Усі правила стануть неактивними. |
| `sudo ufw status` | Показати поточний стан брандмауера (активний/неактивний) та список правил. |
| `sudo ufw status verbose` | Показати розширений стан, включаючи політики за замовчуванням. |
| `sudo ufw status numbered` | Показати правила з їхніми порядковими номерами, що зручно для видалення. |
| `sudo ufw reload` | Перезавантажити правила брандмауера. |
| `sudo ufw reset` | Скинути всі налаштування брандмауера до стану за замовчуванням. **Обережно!** |

#### 2. Політики за замовчуванням
Політики за замовчуванням визначають, що робити з трафіком, який не відповідає жодному з правил.

| Команда | Опис |
| :--- | :--- |
| `sudo ufw default deny incoming` | **(Рекомендовано)** Забороняти всі вхідні з'єднання за замовчуванням. |
| `sudo ufw default allow outgoing` | **(Рекомендовано)** Дозволяти всі вихідні з'єднання за замовчуванням. |
| `sudo ufw default allow incoming` | Дозволяти всі вхідні з'єднання. **Небезпечно!** |
| `sudo ufw default deny outgoing` | Забороняти всі вихідні з'єднання. |

---

### **Керування правилами**

#### 1. Додавання правил (`allow` / `deny`)

Синтаксис для додавання правил дуже гнучкий.

| Команда | Опис |
| :--- | :--- |
| `sudo ufw allow <порт>` | Дозволити трафік на вказаний порт (TCP та UDP). |
| `sudo ufw allow <порт>/<протокол>` | Дозволити трафік для конкретного протоколу (наприклад, `sudo ufw allow 22/tcp`). |
| `sudo ufw allow from <ip_адреса>` | Дозволити з'єднання з певної IP-адреси. |
| `sudo ufw allow from <ip_адреса> to any port <порт>` | Дозволити з'єднання з IP на конкретний порт. |
| `sudo ufw allow <назва_сервісу>` | Дозволити трафік для сервісу (наприклад, `sudo ufw allow ssh`). Імена сервісів беруться з файлу `/etc/services`. |
| `sudo ufw deny <порт>` | Заборонити трафік на вказаний порт. |

#### 2. Видалення правил

| Команда | Опис |
| :--- | :--- |
| `sudo ufw delete allow <порт>` | Видалити правило, що дозволяє трафік на порт. |
| `sudo ufw delete <номер_правила>` | Видалити правило за його порядковим номером (номер можна дізнатися через `sudo ufw status numbered`). |

---

### **Приклади використання**

1.  **Початкове налаштування брандмауера:**
    ```bash
    # 1. Скидаємо всі правила на випадок, якщо щось було налаштовано
    sudo ufw reset

    # 2. Встановлюємо політики за замовчуванням
    sudo ufw default deny incoming
    sudo ufw default allow outgoing

    # 3. Дозволяємо необхідні сервіси (наприклад, SSH)
    sudo ufw allow ssh  # Або sudo ufw allow 22/tcp

    # 4. Вмикаємо брандмауер
    sudo ufw enable
    ```

2.  **Перевірка статусу:**
    ```bash
    sudo ufw status
    ```
    Вивід:
    ```
    Status: active

    To                         Action      From
    --                         ------      ----
    22/tcp                     ALLOW       Anywhere
    ```

3.  **Дозволити доступ до веб-сервера (HTTP та HTTPS):**
    ```bash
    sudo ufw allow http   # Порт 80
    sudo ufw allow https  # Порт 443
    ```
    Або за номерами портів:
    ```bash
    sudo ufw allow 80/tcp
    sudo ufw allow 443/tcp
    ```

4.  **Дозволити доступ до порту тільки з певної IP-адреси:**
    Наприклад, дозволити доступ до бази даних MySQL (порт 3306) тільки з сервера додатків (192.168.1.100).
    ```bash
    sudo ufw allow from 192.168.1.100 to any port 3306
    ```

5.  **Заборонити доступ з певної IP-адреси:**
    ```bash
    sudo ufw deny from 203.0.113.10
    ```

6.  **Видалення правила:**
    Спочатку дивимося номери правил:
    ```bash
    sudo ufw status numbered
    ```
    Вивід:
    ```
    Status: active
         To                         Action      From
         --                         ------      ----
    [ 1] 22/tcp                     ALLOW IN    Anywhere
    [ 2] 80/tcp                     ALLOW IN    Anywhere
    [ 3] 443/tcp                    ALLOW IN    Anywhere
    ```
    Тепер видаляємо правило (наприклад, для HTTP):
    ```bash
    sudo ufw delete 2
    ```

---

### **Робота з додатками**

`ufw` може використовувати профілі додатків, які зберігаються в `/etc/ufw/applications.d`.

1.  **Показати список доступних профілів додатків:**
    ```bash
    sudo ufw app list
    ```

2.  **Дозволити трафік для профілю:**
    Наприклад, для Nginx, який має кілька профілів (`Nginx Full`, `Nginx HTTP`, `Nginx HTTPS`).
    ```bash
    sudo ufw allow 'Nginx Full'
    ```

3.  **Подивитися інформацію про профіль:**
    ```bash
    sudo ufw app info 'Nginx Full'
    ```