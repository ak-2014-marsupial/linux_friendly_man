# ip

Утиліта `ip` — це потужний інструмент командного рядка з пакету `iproute2`, призначений для перегляду та налаштування мережевої підсистеми в ядрі Linux. Вона є сучасною заміною для застарілих команд, таких як `ifconfig`, `route` та `arp`.

#### **Базовий синтаксис**

Команда `ip` має об'єктно-орієнтований синтаксис:

```bash
ip [ ОПЦІЇ ] ОБ'ЄКТ { КОМАНДА | help }
```

*   **`ОБ'ЄКТ`**: тип об'єкта, яким потрібно керувати. Найпоширеніші:
    *   `link`: мережевий інтерфейс.
    *   `address` (або `addr`): IP-адреса на інтерфейсі.
    *   `route`: запис у таблиці маршрутизації.
    *   `neigh` (або `neighbour`): запис у ARP-таблиці (сусід).
*   **`КОМАНДА`**: дія, яку потрібно виконати над об'єктом (наприклад, `show`, `add`, `del`).

--- 

### **Основні об'єкти та команди**

#### **1. `ip link` — Управління мережевими інтерфейсами**

Цей об'єкт використовується для налаштування фізичних та віртуальних мережевих пристроїв.

| Команда | Пояснення |
| :--- | :--- |
| **`show`** | Показати список та стан усіх мережевих інтерфейсів. |
| **`set dev [назва] up`** | Увімкнути інтерфейс. |
| **`set dev [назва] down`**| Вимкнути інтерфейс. |
| **`set dev [назва] mtu [N]`** | Встановити новий розмір MTU (Maximum Transmission Unit). |

#### **2. `ip address` — Управління IP-адресами**

Скорочений варіант: `ip addr`. Використовується для роботи з IP-адресами.

| Команда | Пояснення |
| :--- | :--- |
| **`show`** | Показати всі IP-адреси на всіх інтерфейсах. |
| **`show dev [назва]`** | Показати IP-адреси на конкретному інтерфейсі. |
| **`add [адреса]/[маска] dev [назва]`** | Призначити IP-адресу інтерфейсу. |
| **`del [адреса]/[маска] dev [назва]`** | Видалити IP-адресу з інтерфейсу. |
| **`flush dev [назва]`** | Видалити всі IP-адреси з інтерфейсу. |

#### **3. `ip route` — Управління таблицею маршрутизації**

Дозволяє переглядати та змінювати таблицю маршрутизації ядра.

| Команда | Пояснення |
| :--- | :--- |
| **`show`** (або `list`) | Показати таблицю маршрутизації. |
| **`add [мережа]/[маска] via [шлюз]`** | Додати статичний маршрут до мережі через вказаний шлюз. |
| **`add default via [шлюз]`** | Додати маршрут за замовчуванням (default gateway). |
| **`del [мережа]/[маска]`** | Видалити статичний маршрут. |
| **`get [IP-адреса]`** | Показати, який маршрут буде використано для трафіку до вказаної IP-адреси. |

#### **4. `ip neigh` — Управління ARP-таблицею**

Скорочений варіант: `ip n`. Використовується для роботи з таблицею сусідів (ARP-кеш).

| Команда | Пояснення |
| :--- | :--- |
| **`show`** | Показати ARP-таблицю. |
| **`flush dev [назва]`** | Очистити ARP-кеш для вказаного інтерфейсу. |

--- 

### **Приклади використання**

1.  **Показати всі мережеві інтерфейси та їх стан:**
    ```bash
    ip link show
    ```

2.  **Показати детальну інформацію про один інтерфейс (наприклад, `eth0`):**
    ```bash
    ip addr show eth0
    ```

3.  **Увімкнути інтерфейс `eth0`:**
    ```bash
    sudo ip link set eth0 up
    ```

4.  **Призначити IP-адресу `192.168.1.100` з маскою `24` інтерфейсу `eth0`:**
    ```bash
    sudo ip addr add 192.168.1.100/24 dev eth0
    ```

5.  **Видалити цю IP-адресу:**
    ```bash
    sudo ip addr del 192.168.1.100/24 dev eth0
    ```

6.  **Показати поточну таблицю маршрутизації:**
    ```bash
    ip route
    ```

7.  **Додати шлюз за замовчуванням `192.168.1.1`:**
    ```bash
    sudo ip route add default via 192.168.1.1
    ```

8.  **Додати статичний маршрут до мережі `10.10.0.0/16` через шлюз `192.168.1.254`:**
    ```bash
    sudo ip route add 10.10.0.0/16 via 192.168.1.254
    ```

9.  **Показати ARP-таблицю (відомих сусідів у локальній мережі):**
    ```bash
    ip neigh
    ```

10. **Дізнатися, яким маршрутом піде трафік до `8.8.8.8`:**
    ```bash
    ip route get 8.8.8.8
    ```

11. **Показати статистику (кількість пакетів, помилки) для всіх інтерфейсів:**
    ```bash
    ip -s link
    ```

---

### **Додаткові приклади з поясненнями**

#### **1. `ip address show` — Перегляд IP-адрес**

Ця команда показує IP-адреси, призначені мережевим інтерфейсам.

```bash
ip address show
```

**Приклад виводу:**
```
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:15:5d:01:02:03 brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.101/24 brd 192.168.1.255 scope global dynamic noprefixroute eth0
       valid_lft 86350sec preferred_lft 86350sec
    inet6 fe80::215:5dff:fe01:203/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
```

*   **`1: lo`**: Інтерфейс `loopback` (локальна петля), завжди активний.
*   **`2: eth0`**: Фізичний мережевий інтерфейс.
*   **`inet 192.168.1.101/24`**: Призначена IPv4-адреса з маскою `/24`.
*   **`scope global`**: Адреса доступна ззовні. `scope host` — тільки в межах хоста.
*   **`dynamic`**: Адреса отримана динамічно (наприклад, через DHCP).
*   **`inet6 fe80::...`**: Локальна IPv6-адреса (`link-local`).

#### **2. `ip route show` — Перегляд таблиці маршрутизації**

Команда показує, як система буде відправляти мережевий трафік.

```bash
ip route show
```

**Приклад виводу:**
```
default via 192.168.1.1 dev eth0 proto dhcp metric 100 
172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 
192.168.1.0/24 dev eth0 proto kernel scope link src 192.168.1.101 metric 100
```

*   **`default via 192.168.1.1 dev eth0`**: Маршрут за замовчуванням. Увесь трафік, для якого немає конкретного маршруту, піде через шлюз `192.168.1.1` на інтерфейсі `eth0`.
*   **`192.168.1.0/24 dev eth0`**: Маршрут для локальної мережі. Трафік до будь-якої адреси в діапазоні `192.168.1.0` - `192.168.1.255` відправлятиметься напряму через інтерфейс `eth0`.
*   **`172.17.0.0/16 dev docker0`**: Маршрут, створений ядром (`proto kernel`) для мережі Docker.

#### **3. `ip neighbour show` — Перегляд ARP-таблиці**

Показує відповідність між IP-адресами та MAC-адресами пристроїв у локальній мережі.

```bash
ip neighbour show
```

**Приклад виводу:**
```
192.168.1.1 dev eth0 lladdr 00:aa:bb:cc:dd:ee REACHABLE
192.168.1.5 dev eth0 lladdr 11:22:33:44:55:66 STALE
```

*   **`192.168.1.1 dev eth0`**: IP-адреса сусіда та інтерфейс, через який він доступний.
*   **`lladdr 00:aa:bb:cc:dd:ee`**: MAC-адреса (`link-layer address`) цього сусіда.
*   **`REACHABLE`**: Запис актуальний, нещодавно було підтвердження доступності.
*   **`STALE`**: Запис застарів, але все ще вважається дійсним. При наступному зверненні система перевірить його актуальність.
*   Інші можливі стани: `DELAY`, `PROBE`, `FAILED`.

#### **4. `ip -s link` — Перегляд статистики інтерфейсів**

Ключ `-s` (statistics) додає детальну статистику про роботу інтерфейсів.

```bash
ip -s link
```

**Приклад виводу для одного інтерфейсу:**
```
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    link/ether 00:15:5d:01:02:03 brd ff:ff:ff:ff:ff:ff
    RX: bytes  packets  errors  dropped overrun mcast   
    12345678   98765    0       0       0       0       
    TX: bytes  packets  errors  dropped carrier collsns 
    87654321   56789    0       0       0       0
```

*   **`RX` (Receive)**: Статистика отриманих даних.
    *   **`bytes`**: Кількість отриманих байтів.
    *   **`packets`**: Кількість отриманих пакетів.
    *   **`errors`**: Помилки при отриманні.
    *   **`dropped`**: Пакети, що були відкинуті ядром (наприклад, через брак пам'яті).
*   **`TX` (Transmit)**: Статистика відправлених даних.
    *   **`bytes`**: Кількість відправлених байтів.
    *   **`packets`**: Кількість відправлених пакетів.
    *   **`errors`**: Помилки при відправленні.
    *   **`carrier`**: Помилки, пов'язані з фізичним з'єднанням (наприклад, кабель від'єднано).

### **Додаткові приклади з Інтернету з поясненнями**

*   `ip help` - **Показати довідку** по команді `ip`.
*   `ip link show` - **Показати всі мережеві інтерфейси**.
*   `ip link ls up` - **Показати тільки активні мережеві інтерфейси**.
*   `ip link show dev [device]` - **Показати інформацію про конкретний інтерфейс**.
*   `ip link show dev enp0s3` - **Приклад попередньої команди для інтерфейсу `enp0s3`**.
*   `ip -s link` - **Показати статистику для мережевих інтерфейсів**.
*   `ip -s link ls [interface]` - **Показати статистику для конкретного інтерфейсу**.
*   `ip -s link ls enp0s3` - **Приклад попередньої команди для інтерфейсу `enp0s3`**.
*   `ip -s -s link ls enp0s3` - **Показати більш детальну статистику для конкретного інтерфейсу**.
*   `sudo ip link set enp0s3 down` - **Вимкнути інтерфейс `enp0s3`**.
*   `ip link set enp0s3 up` - **Увімкнути інтерфейс `enp0s3`**.
*   `sudo ip link set txqueuelen [number] dev [interface]` - **Встановити довжину черги передачі для інтерфейсу**.
*   `sudo ip link set txqueuelen 10000 dev enp0s3` - **Приклад попередньої команди**.
*   `sudo ip link set mtu [number] dev [interface]` - **Встановити MTU для інтерфейсу**.
*   `sudo ip link set mtu 10000 dev enp0s3` - **Приклад попередньої команди**.
*   `ip link set dev [interface] address [mac_address]` - **Встановити MAC-адресу для інтерфейсу**.
*   `ip addr` - **Показати IP-адреси всіх інтерфейсів**.
*   `ip addr show` - **Те саме, що й `ip addr`**.
*   `ip addr show dev enp0s3` - **Показати IP-адреси для конкретного інтерфейсу `enp0s3`**.
*   `ip -4 addr` - **Показати тільки IPv4-адреси**.
*   `ip -6 addr` - **Показати тільки IPv6-адреси**.
*   `sudo ip addr add [ip_address] dev [interface]` - **Додати IP-адресу до інтерфейсу**.
*   `sudo ip addr add 10.0.2.12 dev enp0s3` - **Приклад попередньої команди**.
*   `ip a` - **Скорочений варіант `ip addr`**.
*   `sudo ip addr add brd [ip_address] dev [interface]` - **Додати широкомовну адресу до інтерфейсу**.
*   `ip addr del [ip_address] dev [interface]` - **Видалити IP-адресу з інтерфейсу**.
*   `ip addr del 10.0.2.12/32 dev enp0s3` - **Приклад попередньої команди**.
*   `ip route` - **Показати таблицю маршрутизації**.
*   `ip route list` - **Те саме, що й `ip route`**.
*   `ip route list [selector]` - **Показати маршрути за певним селектором**.
*   `ip route list table local` - **Показати локальну таблицю маршрутизації**.
*   `ip route list [ip_address]` - **Показати маршрут для конкретної IP-адреси**.
*   `ip route add [ip_address] dev [interface]` - **Додати маршрут для IP-адреси через інтерфейс**.
*   `ip route add [ip_address] via [gateway_IP] dev [interface]` - **Додати маршрут для IP-адреси через шлюз**.
*   `sudo ip route add 192.168.0.0/24 via 192.168.0.254 dev enp0s3` - **Приклад попередньої команди**.
*   `sudo ip route add default 192.168.0.0/24 via 192.168.0.254 dev enp0s3` - **Додати маршрут за замовчуванням**.
*   `ip route del [ip_address]` - **Видалити маршрут для IP-адреси**.
*   `ip route del default` - **Видалити маршрут за замовчуванням**.
*   `ip neigh show` - **Показати ARP-таблицю**.
*   `ip neigh add [ip_address] dev [interface]` - **Додати запис до ARP-таблиці**.
*   `ip neigh del [ip_address] dev [interface]` - **Видалити запис з ARP-таблиці**.
*   `ip -c link` - **Показати інформацію про мережеві інтерфейси з кольоровим виводом**.