Утиліта `traceroute` — це інструмент для діагностики мережі, який дозволяє відстежити маршрут, яким проходять пакети даних від вашого комп'ютера до кінцевого вузла (сервера). Вона показує послідовність маршрутизаторів (хопів), через які проходить ваш трафік, і вимірює затримку до кожного з них.

Це незамінний інструмент для виявлення проблем у мережі, наприклад, щоб зрозуміти, на якій ділянці шляху губляться пакети або виникає велика затримка.

#### **Базовий синтаксис**

```bash
traceroute [ключі] [хост]
```

*   **`[хост]`**: IP-адреса або доменне ім'я кінцевого вузла.

---

### **Як працює `traceroute`?**

`traceroute` надсилає серію пакетів до кінцевого хоста, але з навмисно обмеженим "часом життя" (Time To Live, TTL).

1.  Спочатку надсилається пакет із `TTL=1`. Перший же маршрутизатор на шляху зменшує TTL до 0, відкидає пакет і надсилає назад ICMP-повідомлення "Time Exceeded". `traceroute` фіксує IP-адресу цього маршрутизатора та час, який знадобився на відповідь.
2.  Далі надсилається пакет із `TTL=2`. Він проходить перший маршрутизатор, але його відкидає другий, який також надсилає відповідь.
3.  Цей процес повторюється, збільшуючи TTL на 1 з кожним кроком, доки пакет не досягне кінцевого вузла.

### **Як читати вивід?**

```
traceroute to google.com (142.250.180.238), 30 hops max, 60 byte packets
 1  _gateway (192.168.1.1)  0.543 ms  0.489 ms  0.472 ms
 2  isp-router.net (10.0.0.1)  5.123 ms  5.098 ms  5.150 ms
 3  * * *
 4  another-router.com (203.0.113.5)  15.678 ms  15.701 ms  15.655 ms
 ...
10  142.250.180.238 (142.250.180.238)  20.111 ms  20.089 ms  20.123 ms
```

*   **Перший стовпець**: Номер хопу (маршрутизатора) на шляху.
*   **Другий стовпець**: Ім'я хоста та/або його IP-адреса.
*   **Наступні три стовпці**: Час затримки (ping) для трьох різних пакетів, надісланих на цей хоп. Це дозволяє оцінити стабільність з'єднання.
*   **`* * *`**: Означає, що від цього хопу не надійшло відповіді протягом таймауту. Це може бути через налаштування файрволу на маршрутизаторі або перевантаження мережі.

---

### **Основні ключі**

*   **`-n`**
    Не перетворювати IP-адреси на імена хостів. Це значно прискорює процес трасування.

*   **`-I`** (ICMP)
    Використовувати ICMP ECHO пакети для трасування (схоже на `ping`). У деяких мережах UDP-пакети (за замовчуванням) можуть блокуватися, а ICMP — ні.

*   **`-T`** (TCP)
    Використовувати TCP SYN пакети. Це корисно для трасування до певного порту, щоб перевірити, чи не блокує його файрвол на шляху.

*   **`-p порт`**
    Використовується разом із `-T`, щоб вказати порт призначення (за замовчуванням 80).

*   **`-q кількість_запитів`**
    Встановити кількість пакетів, що надсилаються на кожен хоп (за замовчуванням 3).

*   **`-w таймаут`**
    Встановити час очікування відповіді від хопу (в секундах).

---

### **Приклади використання**

1.  **Просте трасування до домену:**
    ```bash
    traceroute google.com
    ```

2.  **Прискорене трасування без перетворення IP в імена:**
    ```bash
    traceroute -n google.com
    ```

3.  **Трасування за допомогою ICMP-пакетів:**
    ```bash
    sudo traceroute -I github.com
    ```
    *(Зазвичай вимагає прав суперкористувача)*

4.  **Трасування до веб-сервера через TCP до порту 443 (HTTPS):**
    ```bash
    sudo traceroute -T -p 443 apple.com
    ```
    *Це допоможе зрозуміти, чи блокується HTTPS-трафік на якомусь із проміжних вузлів.*

5.  **Збільшити кількість запитів до 5 на кожен хоп для кращої оцінки стабільності:**
    ```bash
    traceroute -q 5 wikipedia.org
    ```

6.  **Обмежити максимальну кількість хопів (наприклад, до 10):**
    ```bash
    traceroute -m 10 google.com
    ```
