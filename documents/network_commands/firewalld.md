`firewalld` (Firewall Daemon) — це динамічний менеджер брандмауера, який є стандартним у багатьох сучасних дистрибутивах Linux, зокрема в RHEL, CentOS та Fedora. Він надає динамічно керований брандмауер з підтримкою "зон" для визначення рівня довіри до мережевих з'єднань або інтерфейсів.

`firewalld` працює як сервіс (демон) і може змінювати правила без розриву існуючих з'єднань. Для керування ним використовується утиліта командного рядка `firewall-cmd`.

### **Джерела інформації**
`firewalld` зберігає свої конфігурації у XML-файлах, розташованих у двох основних директоріях:
*   **/usr/lib/firewalld/**: Стандартна конфігурація за замовчуванням (сервіси, зони). Не рекомендується редагувати ці файли напряму.
*   **/etc/firewalld/**: Користувацькі конфігурації. Файли в цій директорії мають вищий пріоритет і перевизначають налаштування за замовчуванням.

---

### **Основні концепції**

#### 1. Зони (Zones)
Зона — це попередньо визначений набір правил, що застосовується до мережевого інтерфейсу. Кожна зона представляє певний рівень довіри.

| Зона | Рівень довіри | Опис |
| :--- | :--- | :--- |
| `public` | Не довірена | Для використання в публічних мережах. Ви довіряєте іншим комп'ютерам у мережі мінімально. |
| `home` | Обмежена довіра | Для домашніх мереж. Ви переважно довіряєте іншим комп'ютерам. |
| `work` | Обмежена довіра | Для робочих мереж. |
| `internal` | Довірена | Для внутрішніх мереж. Ви повністю довіряєте іншим комп'ютерам. |
| `trusted` | Повністю довірена | Дозволяє весь мережевий трафік. |
| `dmz` | Демілітаризована зона | Для комп'ютерів у ДМЗ з обмеженим доступом до вашої внутрішньої мережі. |
| `block` | Не довірена | Всі вхідні з'єднання відхиляються з повідомленням `icmp-host-prohibited`. |
| `drop` | Не довірена | Всі вхідні з'єднання мовчки відкидаються без будь-якої відповіді. |

#### 2. Постійна та тимчасова конфігурація (Permanent vs. Runtime)
`firewalld` має два режими конфігурації:
*   **Тимчасова (Runtime):** Зміни застосовуються негайно, але будуть втрачені після перезавантаження сервісу або системи. Це режим за замовчуванням.
*   **Постійна (Permanent):** Зміни зберігаються у конфігураційних файлах і застосовуються після перезавантаження. Щоб додати правило в постійну конфігурацію, використовується прапор `--permanent`.

---

### **Базовий синтаксис**

```bash
sudo firewall-cmd [опції]
```

---

### **Основні команди**

#### 1. Керування брандмауером

| Команда | Опис |
| :--- | :--- |
| `sudo systemctl start firewalld` | Запустити сервіс `firewalld`. |
| `sudo systemctl enable firewalld` | Увімкнути автозапуск сервісу. |
| `sudo systemctl status firewalld` | Перевірити статус сервісу. |
| `sudo firewall-cmd --state` | Перевірити, чи запущений `firewalld`. |
| `sudo firewall-cmd --reload` | Перезавантажити конфігурацію з постійних правил. Розриває існуючі з'єднання, які більше не дозволені. |
| `sudo firewall-cmd --runtime-to-permanent` | Зберегти поточні тимчасові правила в постійну конфігурацію. |

#### 2. Керування зонами

| Команда | Опис |
| :--- | :--- |
| `sudo firewall-cmd --get-default-zone` | Показати зону за замовчуванням. |
| `sudo firewall-cmd --set-default-zone=<зона>` | Встановити зону за замовчуванням. |
| `sudo firewall-cmd --get-active-zones` | Показати активні зони та інтерфейси, прив'язані до них. |
| `sudo firewall-cmd --zone=<зона> --list-all` | Показати повну конфігурацію для вказаної зони. |
| `sudo firewall-cmd --zone=<зона> --add-interface=<інтерфейс>` | Прив'язати інтерфейс до зони. |
| `sudo firewall-cmd --zone=<зона> --change-interface=<інтерфейс>` | Змінити зону для інтерфейсу. |

#### 3. Керування сервісами та портами

| Команда | Опис |
| :--- | :--- |
| `sudo firewall-cmd --list-services` | Показати дозволені сервіси в зоні за замовчуванням. |
| `sudo firewall-cmd --zone=<зона> --add-service=<сервіс>` | Дозволити сервіс у вказаній зоні. |
| `sudo firewall-cmd --zone=<зона> --remove-service=<сервіс>` | Заборонити сервіс. |
| `sudo firewall-cmd --zone=<зона> --add-port=<порт>/<протокол>` | Дозволити порт (наприклад, `8080/tcp`). |
| `sudo firewall-cmd --zone=<зона> --remove-port=<порт>/<протокол>` | Заборонити порт. |

*Щоб зробити будь-яку з цих змін постійною, додайте прапор `--permanent`.*

---

### **Приклади використання**

1.  **Перевірити стан та активні зони:**
    ```bash
    sudo firewall-cmd --state
    sudo firewall-cmd --get-active-zones
    ```

2.  **Подивитися конфігурацію для публічної зони:**
    ```bash
    sudo firewall-cmd --zone=public --list-all
    ```

3.  **Дозволити HTTP та HTTPS трафік (тимчасово):**
    ```bash
    sudo firewall-cmd --zone=public --add-service=http
    sudo firewall-cmd --zone=public --add-service=https
    ```

4.  **Дозволити HTTP та HTTPS трафік (постійно):**
    ```bash
    sudo firewall-cmd --zone=public --permanent --add-service=http
    sudo firewall-cmd --zone=public --permanent --add-service=https
    ```
    Після цього потрібно перезавантажити `firewalld`:
    ```bash
    sudo firewall-cmd --reload
    ```

5.  **Відкрити порт 8080 для TCP (постійно):**
    ```bash
    sudo firewall-cmd --zone=public --permanent --add-port=8080/tcp
    sudo firewall-cmd --reload
    ```

6.  **Видалити правило для порту 8080/tcp:**
    ```bash
    sudo firewall-cmd --zone=public --permanent --remove-port=8080/tcp
    sudo firewall-cmd --reload
    ```

7.  **Дозволити трафік з певної IP-адреси:**
    Для цього використовується "Rich Rule".
    ```bash
    sudo firewall-cmd --zone=public --permanent --add-rich-rule='rule family="ipv4" source address="192.168.1.100" accept'
    sudo firewall-cmd --reload
    ```

8.  **Перенести інтерфейс `eth1` в зону `internal`:**
    ```bash
    sudo firewall-cmd --zone=internal --add-interface=eth1 --permanent
    sudo firewall-cmd --reload
    ```
